<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fish & Chips | Premium Menu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* * FINAL COLOR PALETTE: RED, YELLOW, AND BLUE (FOR BACKGROUND)
     */
    :root {
      --primary-red: #cc0000; /* Primary Red (Header/Buttons) */
      --red-dark: #8c0000; /* Darker Red */
      --yellow-gold: #ffcc00; /* Gold/Yellow Accent */
      --blue-bg: #d9e9ff; /* Light Blue/White tint for Main BG (as requested) */
      --card-bg: #fff5e0; /* Light Yellow Card Background */
      --text-main: #332b00; /* Very Dark Text */
      --text-muted: #665b26; /* Darker Muted Text */
      --search-bg: #ffffff; /* White Search Bar (as requested) */
      --radius-lg: 12px;
      --shadow-soft: 0 5px 15px rgba(0, 0, 0, 0.08);
      --shadow-deep: 0 15px 35px rgba(0, 0, 0, 0.2);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Poppins', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: var(--blue-bg); /* Main background is blue tint */
      color: var(--text-main);
      overflow: hidden; 
    }

    .page {
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ===== HEADER (RED/GOLD) ===== */
    header {
      position: fixed; 
      top: 0;
      left: 0;
      right: 0;
      z-index: 20;
      background: linear-gradient(135deg, var(--red-dark), var(--primary-red));
      color: #ffffff;
      padding: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .header-inner {
      max-width: 1100px;
      margin: 0 auto;
    }

    .brand-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
    }

    .brand-title-group {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .scroll-arrow {
        font-size: 24px;
        color: var(--yellow-gold);
        transform: rotate(0deg);
        transition: transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
        opacity: 0;
        visibility: hidden;
    }
    
    .scrolling .scroll-arrow {
        opacity: 1;
        visibility: visible;
        animation: rotateArrow 4s linear infinite;
    }
    
    @keyframes rotateArrow {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    .brand-name {
      font-size: 26px; 
      font-weight: 800;
      letter-spacing: 0.05em;
      color: #ffffff;
    }

    .brand-tagline {
      font-size: 13px;
      opacity: 0.9;
      color: #ffe0e0;
    }

    .today-sales {
      font-size: 13px;
      padding: 6px 12px;
      border-radius: 999px;
      background: var(--yellow-gold); /* Yellow badge */
      color: var(--red-dark); 
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
      backdrop-filter: blur(4px);
    }

    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #38c172; 
      box-shadow: 0 0 0 4px rgba(56, 193, 114, 0.3);
    }

    .search-box {
      flex: 1;
      background: var(--search-bg); /* White Search Bar */
      border-radius: 999px;
      padding: 8px 14px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.1);
    }

    .search-icon {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      border: 2px solid var(--text-main);
      position: relative;
    }

    .search-icon::after {
      content: "";
      width: 8px;
      height: 2px;
      border-radius: 999px;
      background: var(--text-main);
      position: absolute;
      right: -4px;
      bottom: -1px;
      transform: rotate(40deg);
    }

    #searchInput {
      border: none;
      outline: none;
      background: transparent;
      color: var(--text-main);
      font-size: 14px;
      width: 100%;
    }

    #searchInput::placeholder {
      color: var(--text-muted);
      opacity: 0.8; 
    }

    main {
      flex: 1;
      padding: 16px;
      padding-top: 155px; 
      padding-bottom: 16px;
      overflow-y: auto; 
      /* Background pattern for main area */
      background-image: url('data:image/svg+xml;utf8,<svg width="100%" height="100%" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><rect width="100%" height="100%" fill="none"/><g opacity="0.1" transform="translate(10, 10)"><rect x="0" y="0" width="180" height="180" fill="white"/><path d="M 0,0 L 180,90 L 0,180 Z" fill="%23cc0000"/></g><g opacity="0.08" transform="translate(100, 100) rotate(45)"><rect x="0" y="0" width="100" height="100" fill="white"/><path d="M 0,0 L 100,50 L 0,100 Z" fill="%23cc0000"/></g></svg>'),
      url('data:image/svg+xml;utf8,<svg width="100%" height="100%" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect width="100%" height="100%" fill="none"/><path d="M 50,0 A 50,50 0 0,1 50,100 M 50,0 A 50,50 0 0,0 50,100" stroke="%23ffb84d" stroke-width="2" fill="none" opacity="0.15"/></svg>'),
      url('data:image/svg+xml;utf8,<svg width="100%" height="100%" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect width="100%" height="100%" fill="none"/><path d="M 0,50 L 100,50 M 50,0 L 50,100" stroke="%23cc0000" stroke-width="3" opacity="0.15"/></svg>');
      background-size: 100% 100%, 100% 100%, 100% 100%; 
      background-repeat: no-repeat, no-repeat, no-repeat;
    }

    .content {
      max-width: 1100px;
      margin: 0 auto;
    }

    .section-title {
      margin-bottom: 15px;
      font-size: 22px; 
      font-weight: 700;
      color: var(--red-dark);
      border-left: 5px solid var(--primary-red); 
      padding-left: 10px;
    }

    /* ===== MENU CARDS (3 COLUMNS) ===== */
    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); 
      gap: 20px; 
    }

    .card {
      background: var(--card-bg); 
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-soft);
      overflow: hidden;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1), box-shadow 0.3s ease-out;
      position: relative; /* For the plus button */
    }

    .card:hover {
      transform: translateY(-6px) scale(1.03); 
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    }
    
    .card-img-wrapper {
      width: 100%;
      aspect-ratio: 4 / 3;
      overflow: hidden;
      background: var(--yellow-light);
    }
    
    .card-body {
      padding: 12px;
      background: var(--yellow-light); 
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      color: var(--red-dark); 
    }

    .card-price {
      font-size: 14px;
      color: var(--primary-red);
      font-weight: 800;
      margin-top: 5px;
    }

    /* NEW: Direct Add to Cart Button */
    .add-to-cart-btn {
      position: absolute;
      bottom: 0px;
      right: 0px;
      background: var(--primary-red);
      color: var(--yellow-gold);
      border: none;
      width: 35px;
      height: 35px;
      border-radius: 12px 0 12px 0;
      font-size: 20px;
      cursor: pointer;
      line-height: 1;
      transition: background 0.2s, transform 0.2s;
      z-index: 5;
    }
    
    .add-to-cart-btn:hover {
        background: var(--red-dark);
        transform: scale(1.05);
    }

    /* ===== MODAL (RED/YELLOW) ===== */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 30;
      padding: 20px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease-out;
    }

    .modal-backdrop.show {
      opacity: 1;
      pointer-events: auto;
    }

    .modal {
      background: transparent;
      border-radius: 28px;
      max-width: 450px;
      width: 100%;
      overflow: visible;
      display: flex;
      flex-direction: column;
      
      transform: translateY(50px) scale(0.85);
      opacity: 0;
      transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.5s ease-out; 
    }

    .modal-backdrop.show .modal {
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    /* MODAL INFO BOX - Glassmorphism Style */
    .modal-body {
      position: relative;
      margin: -24px 12px 0;
      padding: 20px;
      /* RED/YELLOW Glassmorphism Look */
      background: linear-gradient(135deg, rgba(255, 240, 200, 0.95), rgba(255, 200, 150, 0.85));
      backdrop-filter: blur(10px); 
      border: 1px solid rgba(255, 255, 255, 0.5); 
      border-radius: 20px;
      box-shadow: var(--shadow-deep);
    }

    .modal-price {
      font-size: 20px;
      font-weight: 800;
      color: var(--primary-red);
    }
    
    /* Option Selection */
    .modal-options-group {
        margin-bottom: 15px;
        padding-top: 10px;
    }
    
    .option-radio {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--card-bg);
        padding: 10px 15px;
        border-radius: 8px;
        margin-bottom: 8px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: all 0.2s;
    }
    
    .option-radio.selected {
        border-color: var(--primary-red);
        background: var(--yellow-light);
    }
    
    .option-name {
        font-weight: 600;
        color: var(--text-main);
    }
    
    .option-price {
        font-weight: 800;
        color: var(--primary-red);
    }

    /* Buttons in modal use red theme */
    .btn-primary {
      background: var(--primary-red);
      color: #ffffff;
      box-shadow: 0 10px 20px rgba(204, 0, 0, 0.4);
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        background: var(--red-dark);
        box-shadow: 0 14px 28px rgba(204, 0, 0, 0.6);
    }
    
    .btn-ghost {
      background: transparent;
      color: var(--red-dark); 
    }
    
    /* Admin list items (buttons) */
    .btn-edit-price {
      background: var(--yellow-gold);
      color: var(--red-dark);
      border: 1px solid var(--red-dark);
      font-weight: 600;
    }

    /* Footer is now simpler and yellow themed */
    footer {
      position: fixed; 
      bottom: 0;
      left: 0;
      right: 0;
      padding: 12px;
      background: var(--card-bg);
      font-size: 12px;
      text-align: center;
      color: var(--text-muted);
      box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1);
      z-index: 10;
    }
    
    @media (max-width: 720px) {
      main {
        padding: 14px 10px 18px;
        padding-top: 155px; 
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="header-inner">
        <div class="brand-row">
          <div class="brand-title-group">
            <div class="scroll-arrow">⟳</div> 
            <div class="brand-name">Fish & Chips</div> 
          </div>
          <div class="today-sales" id="todaySalesBadge">
            <span class="badge-dot"></span>
            <span>Today: £0.00</span> 
          </div>
        </div>

        <div class="search-row">
          <div class="search-box">
            <div class="search-icon"></div>
            <input
              id="searchInput"
              type="text"
              placeholder="Search menu..."
              autocomplete="off"
            />
          </div>
        </div>
      </div>
    </header>

    <main id="mainContent">
      <div class="content">
        <h2 class="section-title">Menu</h2>
        <div id="menuGrid" class="menu-grid"></div>
        <div id="noResults" class="no-results" style="display: none;">
          کوئی آئٹم نہیں ملا۔ نام سے سرچ کریں، یا ایڈمن موڈ میں نیا آئٹم add کریں۔
        </div>
      </div>
    </main>

    <footer>
      © <span id="year"></span> Fish & Chips
    </footer>
  </div>

  <div id="itemModalBackdrop" class="modal-backdrop">
    <div class="modal">
      <div class="modal-img-wrapper">
        <img id="modalImg" class="modal-img" src="" alt="" />
      </div>
      <div class="modal-body">
        <div class="modal-title-row">
          <div class="modal-name" id="modalName">Item name</div>
          <div class="modal-price" id="modalPrice">£0.00</div> 
        </div>
        
        <div class="modal-options-group" id="optionsGroup" style="display: none;">
          </div>
        
        <div class="modal-desc" id="modalDesc">
          Description here...
        </div>
        <div class="modal-footer">
          <button class="btn btn-ghost" id="modalCloseBtn">Close</button>
          <button class="btn btn-primary" id="modalOrderBtn">
            Direct Order
          </button>
        </div>
      </div>
    </div>
  </div>

  <aside id="adminPanel" class="admin-panel">
    <div class="admin-header">
      <div>
        <div class="admin-title">Admin Panel</div>
        <div class="admin-pin">Unlocked with PIN: 2004</div>
      </div>
      <button class="btn btn-ghost" id="adminCloseBtn" style="color: var(--yellow-light);">Close</button>
    </div>
    <div class="admin-body">
      <div class="admin-section-title">
        <span>Today's Sales</span>
      </div>
      <div class="field-group">
        <label class="field-label" for="todaySalesInput">
          Enter total for today (£)
        </label>
        <input
          id="todaySalesInput"
          type="number"
          min="0"
          step="0.01"
          class="field-input"
          placeholder="مثلاً 250.50"
        />
      </div>
      <button class="btn btn-primary" id="saveSalesBtn">Save today total</button>
      <div class="admin-note">
        نوٹ: یہ صرف <strong>آپ کے اس براوزر</strong> میں محفوظ ہوگا (localStorage)۔  
      </div>

      <div class="admin-section-title">
        <span>Add new item (Single Price)</span>
      </div>
      <form id="addItemForm">
        <div class="field-group">
          <label class="field-label" for="itemNameInput">Name</label>
          <input
            id="itemNameInput"
            type="text"
            class="field-input"
            placeholder="مثلاً Chicken Burger"
            required
          />
        </div>
        <div class="field-group">
          <label class="field-label" for="itemPriceInput">Price (£)</label>
          <input
            id="itemPriceInput"
            type="number"
            step="0.01"
            min="0"
            class="field-input"
            placeholder="مثلاً 5.99"
            required
          />
        </div>
        <div class="field-group">
          <label class="field-label" for="itemImgInput">
            Image URL (سرور /images/burger.jpg وغیرہ)
          </label>
          <input
            id="itemImgInput"
            type="text"
            class="field-input"
            placeholder="https://example.com/image.jpg یا /images/burger.jpg"
            required
          />
        </div>
        <div class="field-group">
          <label class="field-label" for="itemDescInput">Short description (optional)</label>
          <input
            id="itemDescInput"
            type="text"
            class="field-input"
            placeholder="مثلاً Spicy grilled chicken burger"
          />
        </div>
        <button type="submit" class="btn btn-primary" style="margin-top: 4px;">
          Add item
        </button>
      </form>

      <div class="admin-section-title">
        <span>All items</span>
      </div>
      <div id="itemsList" class="items-list"></div>
    </div>
  </aside>

  <input type="file" id="changeImageInput" accept="image/*" style="display:none;" />


  <script>
    const ADMIN_PIN = "2004";
    const STORAGE_KEY_ITEMS = "restaurant_menu_items_v2"; // V2 for new data structure
    const STORAGE_KEY_SALES = "restaurant_today_sales";

    // NEW: Updated data structure to include 'options'
    const defaultItems = [
      { id: 1, name: "Chicken Burger", price: 5.99, img: "https://via.placeholder.com/400x300?text=Chicken+Burger", desc: "Crispy chicken burger with lettuce & sauce." },
      { id: 2, name: "Beef Burger", price: 6.50, img: "https://via.placeholder.com/400x300?text=Beef+Burger", desc: "Juicy beef patty with cheese." },
      // Example item with options/variations
      { id: 14, name: "Fish & Chips", 
        options: [
            { id: '14-A', name: "Regular Chips", price: 7.50 },
            { id: '14-B', name: "Large Chips", price: 9.99 }
        ], 
        img: "https://via.placeholder.com/400x300?text=Fish+%26+Chips", 
        desc: "Golden fried fish with your choice of chips size." 
      },
      { id: 3, name: "Margherita Pizza", price: 8.99, img: "https://via.placeholder.com/400x300?text=Margherita+Pizza", desc: "Classic cheese & tomato pizza." },
      { id: 4, name: "Pepperoni Pizza", price: 9.50, img: "https://via.placeholder.com/400x300?text=Pepperoni+Pizza", desc: "Spicy pepperoni with mozzarella." },
      { id: 5, name: "Chicken Biryani", price: 7.99, img: "https://via.placeholder.com/400x300?text=Chicken+Biryani", desc: "Spiced rice with tender chicken." },
      { id: 6, name: "Lamb Karahi", price: 10.99, img: "https://via.placeholder.com/400x300?text=Lamb+Karahi", desc: "Rich lamb curry with spices." },
      { id: 7, name: "Grilled Chicken", price: 9.25, img: "https://via.placeholder.com/400x300?text=Grilled+Chicken", desc: "Charcoal grilled chicken." },
      { id: 8, name: "Shish Kebab", price: 6.99, img: "https://via.placeholder.com/400x300?text=Shish+Kebab", desc: "Tender kebabs with salad." },
      { id: 9, name: "Mixed Grill", price: 12.50, img: "https://via.placeholder.com/400x300?text=Mixed+Grill", desc: "Selection of grilled meats." },
      { id: 10, name: "Chicken Wrap", price: 5.50, img: "https://via.placeholder.com/400x300?text=Chicken+Wrap", desc: "Chicken wrap with sauce." },
      { id: 11, name: "Veggie Wrap", price: 4.99, img: "https://via.placeholder.com/400x300?text=Veggie+Wrap", desc: "Fresh vegetables & hummus." },
      { id: 12, name: "Falafel Plate", price: 6.20, img: "https://via.placeholder.com/400x300?text=Falafel+Plate", desc: "Falafel with salad & dips." },
      { id: 13, name: "Chicken Wings", price: 5.99, img: "https://via.placeholder.com/400x300?text=Chicken+Wings", desc: "Crispy wings with sauce." },
      { id: 15, name: "Cheesy Fries", price: 3.50, img: "https://via.placeholder.com/400x300?text=Cheesy+Fries", desc: "Fries loaded with cheese." },
    ];

    function loadItems() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY_ITEMS);
        if (!raw) return [...defaultItems];
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed) || !parsed.length) return [...defaultItems];
        return parsed;
      } catch (e) {
        console.warn("Failed to load items from localStorage", e);
        return [...defaultItems];
      }
    }

    function saveItems() {
      try {
        localStorage.setItem(STORAGE_KEY_ITEMS, JSON.stringify(items));
      } catch (e) {
        console.warn("Failed to save items", e);
      }
    }

    function loadTodaySales() {
      const raw = localStorage.getItem(STORAGE_KEY_SALES);
      const val = parseFloat(raw);
      if (isNaN(val)) return 0;
      return val;
    }

    function saveTodaySales(val) {
      localStorage.setItem(STORAGE_KEY_SALES, String(val));
    }

    let items = loadItems();
    let filteredItems = [...items];
    let adminOpen = false;
    let currentImageChangeItemId = null;
    let currentModalItemId = null; 
    let selectedOption = null;

    const menuGrid = document.getElementById("menuGrid");
    const noResultsEl = document.getElementById("noResults");
    const itemModalBackdrop = document.getElementById("itemModalBackdrop");
    const modalImg = document.getElementById("modalImg");
    const modalName = document.getElementById("modalName");
    const modalPrice = document.getElementById("modalPrice");
    const modalDesc = document.getElementById("modalDesc");
    const modalCloseBtn = document.getElementById("modalCloseBtn");
    const modalOrderBtn = document.getElementById("modalOrderBtn");
    const optionsGroup = document.getElementById("optionsGroup");
    const searchInput = document.getElementById("searchInput");
    const adminPanel = document.getElementById("adminPanel");
    const adminCloseBtn = document.getElementById("adminCloseBtn");
    const itemsList = document.getElementById("itemsList");
    const todaySalesInput = document.getElementById("todaySalesInput");
    const todaySalesBadge = document.getElementById("todaySalesBadge");
    const saveSalesBtn = document.getElementById("saveSalesBtn");
    const addItemForm = document.getElementById("addItemForm");
    const itemNameInput = document.getElementById("itemNameInput");
    const itemPriceInput = document.getElementById("itemPriceInput");
    const itemImgInput = document.getElementById("itemImgInput");
    const itemDescInput = document.getElementById("itemDescInput");
    const changeImageInput = document.getElementById("changeImageInput");
    const mainContent = document.getElementById("mainContent");
    const yearEl = document.getElementById("year");
    yearEl.textContent = new Date().getFullYear();

    // Scroll listener for arrow animation
    if (mainContent) {
        mainContent.addEventListener('scroll', () => {
            if (mainContent.scrollTop > 5) {
                document.querySelector('.brand-title-group').classList.add('scrolling');
            } else {
                document.querySelector('.brand-title-group').classList.remove('scrolling');
            }
        });
    }

    function formatPrice(p) {
      const num = Number(p);
      if (isNaN(num)) return "£0.00";
      return "£" + num.toFixed(2);
    }
    
    // Function to get the lowest price or fixed price
    function getDisplayPrice(item) {
        if (item.options && item.options.length) {
            const minPrice = item.options.reduce((min, option) => Math.min(min, option.price), Infinity);
            return `From ${formatPrice(minPrice)}`;
        }
        return formatPrice(item.price);
    }

    function getItem(id) {
      return items.find((it) => String(it.id) === String(id));
    }

    function renderMenu(list) {
      menuGrid.innerHTML = "";
      if (!list.length) {
        noResultsEl.style.display = "block";
        return;
      }
      noResultsEl.style.display = "none";

      list.forEach((item) => {
        const card = document.createElement("div");
        card.className = "card";
        card.dataset.id = item.id;

        card.innerHTML = `
          <div class="card-img-wrapper">
            <img src="${item.img}" alt="${item.name}" class="card-img" onerror="this.src='https://via.placeholder.com/400x300?text=No+Image';" />
          </div>
          <div class="card-body">
            <div class="card-name">${item.name}</div>
            <div class="card-price" data-price-id="${item.id}">${getDisplayPrice(item)}</div>
            ${item.desc ? `<div class="card-desc">${item.desc}</div>` : ""}
            <button class="add-to-cart-btn" data-id="${item.id}">+</button>
          </div>
        `;

        card.addEventListener("click", (e) => {
             // Open modal only if the click is not on the + button
             if (!e.target.classList.contains('add-to-cart-btn')) {
                 openItemModal(item.id);
             }
         });
         
        // Direct Add to Cart logic
        card.querySelector('.add-to-cart-btn').addEventListener('click', () => {
             quickAddToCart(item.id);
         });

        menuGrid.appendChild(card);
      });
    }
    
    // NEW: Quick Add to Cart Functionality
    function quickAddToCart(itemId) {
        const item = getItem(itemId);
        if (!item) return;

        let selectedPrice;
        let selectedName;
        
        if (item.options && item.options.length) {
            // For items with options, select the first one (default option)
            const defaultOption = item.options[0];
            selectedPrice = defaultOption.price;
            selectedName = `${item.name} (${defaultOption.name})`;
        } else {
            // For single-price items
            selectedPrice = item.price;
            selectedName = item.name;
        }

        // Simulating adding to cart/order:
        alert(`'${selectedName}' (${formatPrice(selectedPrice)}) has been quickly added to your order (Order simulation).`);
    }


    function openItemModal(itemId) {
      const item = getItem(itemId);
      if (!item) return;
      
      currentModalItemId = itemId; 
      selectedOption = null;
      
      modalImg.src = item.img;
      modalImg.alt = item.name;
      modalName.textContent = item.name;
      modalDesc.textContent = item.desc || "Delicious fresh item from our kitchen.";
      
      // Handle Options vs Single Price
      if (item.options && item.options.length > 0) {
        modalPrice.textContent = "Select Option";
        modalOrderBtn.disabled = true;
        optionsGroup.style.display = 'block';
        optionsGroup.innerHTML = '';
        
        item.options.forEach(option => {
            const optionEl = document.createElement('div');
            optionEl.className = 'option-radio';
            optionEl.dataset.optionId = option.id;
            optionEl.innerHTML = `
                <span class="option-name">${option.name}</span>
                <span class="option-price">${formatPrice(option.price)}</span>
            `;
            
            optionEl.addEventListener('click', () => {
                // Clear previous selection
                optionsGroup.querySelectorAll('.option-radio').forEach(el => {
                    el.classList.remove('selected');
                });
                // Set current selection
                optionEl.classList.add('selected');
                selectedOption = option;
                modalPrice.textContent = formatPrice(option.price);
                modalOrderBtn.disabled = false;
            });
            optionsGroup.appendChild(optionEl);
        });

      } else {
        // Single Price Item
        modalPrice.textContent = getDisplayPrice(item);
        modalOrderBtn.disabled = false;
        optionsGroup.style.display = 'none';
        optionsGroup.innerHTML = ''; // Clear content
      }
      
      itemModalBackdrop.classList.add("show"); 

      // Direct Order Button Logic (Payment Simulation)
      modalOrderBtn.onclick = () => {
        let orderDetail = item.name;
        let orderPrice = item.price;
        
        if (selectedOption) {
            orderDetail += ` (${selectedOption.name})`;
            orderPrice = selectedOption.price;
        }

        // **IMPORTANT:** Payment gateway simulation. 
        // In a real app, this would redirect to a secure payment form (Stripe/PayPal).
        const proceed = confirm(`Are you sure you want to proceed with Direct Order for: ${orderDetail} (${formatPrice(orderPrice)})? (Simulating payment...)`);
        
        if (proceed) {
             alert("✅ Payment Simulated Successfully! Order placed. (Note: Real card processing requires backend integration.)");
             closeItemModal();
        }
      };
    }

    function closeItemModal() {
      itemModalBackdrop.classList.remove("show");
      currentModalItemId = null;
      selectedOption = null; 
    }
    
    // Function to edit options for an item
    function editItemOptions(itemId) {
        const item = getItem(itemId);
        if (!item) return;

        // If it's a single price item, ask to convert it
        if (!item.price && (!item.options || item.options.length === 0)) {
            if (!confirm(`Item "${item.name}" is currently a single-price item. Do you want to convert it to an item with multiple options?`)) {
                return;
            }
            item.options = [];
            delete item.price; // Remove single price property
        }
        
        let newOptionsText = item.options.map(opt => `${opt.name}:${opt.price}`).join('\n');
        
        const newOptionsRaw = prompt(
            `Edit Options for ${item.name}:\n\n` + 
            `Enter each option on a new line in the format:\n` + 
            `Option Name:Price\n\n` + 
            `Example:\nRegular:7.50\nLarge:9.99\n\n` + 
            `Current Options:\n${newOptionsText}`
        );
        
        if (newOptionsRaw === null) return; 

        const lines = newOptionsRaw.split('\n').filter(line => line.trim() !== '');
        let newOptions = [];
        let error = false;
        
        lines.forEach((line, index) => {
            const parts = line.split(':');
            if (parts.length < 2) {
                alert(`Error on line ${index + 1}: Format must be 'Name:Price'.`);
                error = true;
                return;
            }
            const name = parts[0].trim();
            const price = parseFloat(parts[1].trim());
            
            if (!name || isNaN(price) || price < 0) {
                alert(`Error on line ${index + 1}: Name cannot be empty and Price must be a valid number.`);
                error = true;
                return;
            }
            newOptions.push({ 
                id: `${item.id}-${String.fromCharCode(65 + index)}`, // Simple ID generation
                name, 
                price 
            });
        });

        if (error || newOptions.length === 0) {
            if (!error) alert("Options list cannot be empty. Reverting changes.");
            return;
        }

        item.options = newOptions;
        if (item.price) delete item.price; 
        
        saveItems();
        filteredItems = [...items];
        renderItemsList(); 
        renderMenu(filteredItems);
        alert(`${item.name} options updated!`);
    }

    // Function to edit single price for an item
    function editItemPrice(itemId) {
        const item = getItem(itemId);
        if (!item || item.options) return; // Cannot edit price if it has options

        const newPriceRaw = prompt(`Enter new price for ${item.name} (Current: ${formatPrice(item.price)}):`);
        
        if (newPriceRaw === null) return;

        const newPrice = parseFloat(newPriceRaw.trim());

        if (isNaN(newPrice) || newPrice < 0) {
            alert("Invalid input. Please enter a valid number greater than or equal to 0.");
            return;
        }

        item.price = newPrice;
        saveItems();
        
        renderItemsList(); 
        renderMenu(filteredItems); // Re-render to update card price
        alert(`${item.name} price updated to ${formatPrice(newPrice)}!`);
    }

    function openAdminPanel() {
      adminOpen = true;
      adminPanel.classList.add("open");
      searchInput.value = "";
      renderItemsList();
      const today = loadTodaySales();
      todaySalesInput.value = today ? today.toFixed(2) : "";
    }

    function closeAdminPanel() {
      adminOpen = false;
      adminPanel.classList.remove("open");
    }

    function renderItemsList() {
      itemsList.innerHTML = "";
      if (!items.length) {
        itemsList.innerHTML =
          '<div class="items-row"><span>No items yet.</span></div>';
        return;
      }

      items.forEach((item) => {
        const hasOptions = item.options && item.options.length > 0;
        const currentPriceText = hasOptions ? `(${item.options.length} Options)` : formatPrice(item.price);
        
        const row = document.createElement("div");
        row.className = "items-row";
        row.innerHTML = `
          <div>
            <span class="items-row-name">${item.name}</span>
            <span class="items-row-price">${currentPriceText}</span>
          </div>
          <div class="items-row-actions">
            <button class="btn btn-outline btn-edit-price btn-xs" 
                    data-edit-type="${hasOptions ? 'options' : 'price'}" 
                    data-id="${item.id}" 
                    style="padding:2px 8px;font-size:11px; margin-right: 5px;">
                ${hasOptions ? 'Options' : 'Price'}
            </button>
            <button class="btn btn-outline btn-xs" data-image="${item.id}" style="padding:2px 8px;font-size:11px;">
              Image
            </button>
            <button class="btn btn-outline btn-xs" data-delete="${item.id}" style="padding:2px 8px;font-size:11px;">
              Delete
            </button>
          </div>
        `;
        itemsList.appendChild(row);
      });

      // Event Listeners for Edit Price/Options
      itemsList.querySelectorAll("[data-edit-type]").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-id");
          const type = btn.getAttribute("data-edit-type");
          if (type === 'price') {
              editItemPrice(id);
          } else if (type === 'options') {
              editItemOptions(id);
          }
        });
      });
      
      // Event Listeners for Delete
      itemsList.querySelectorAll("[data-delete]").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-delete");
          if (confirm("کیا آپ واقعی یہ آئٹم delete کرنا چاہتے ہیں؟")) {
            items = items.filter((it) => String(it.id) !== String(id));
            saveItems();
            filteredItems = [...items];
            renderItemsList();
            renderMenu(filteredItems);
          }
        });
      });

      // Event Listeners for Image Change
      itemsList.querySelectorAll("[data-image]").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-image");
          currentImageChangeItemId = id;
          changeImageInput.click();
        });
      });
    }

    function updateTodaySalesBadge() {
      const val = loadTodaySales();
      const span = todaySalesBadge.querySelector("span:last-child");
      span.textContent = "Today: " + formatPrice(val);
    }

    searchInput.addEventListener("input", (e) => {
      const value = e.target.value.trim();
      
      // Admin PIN check (Fixed)
      if (value === ADMIN_PIN && !adminOpen) {
        openAdminPanel();
        return;
      }

      const term = value.toLowerCase();
      if (!term) {
        filteredItems = [...items];
      } else {
        filteredItems = items.filter((it) =>
          it.name.toLowerCase().includes(term)
        );
      }
      renderMenu(filteredItems);
    });

    searchInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        const value = searchInput.value.trim();
        if (value === ADMIN_PIN && !adminOpen) {
          e.preventDefault();
          openAdminPanel();
        }
      }
    });

    itemModalBackdrop.addEventListener("click", (e) => {
      if (e.target === itemModalBackdrop) {
        closeItemModal();
      }
    });
    modalCloseBtn.addEventListener("click", closeItemModal);
    adminCloseBtn.addEventListener("click", closeAdminPanel);

    saveSalesBtn.addEventListener("click", () => {
      const raw = todaySalesInput.value.trim();
      const num = parseFloat(raw);
      if (isNaN(num) || num < 0) {
        alert("براہ کرم درست رقم لکھیں (0 سے زیادہ)");
        return;
      }
      saveTodaySales(num);
      updateTodaySalesBadge();
      alert("Today's total saved!");
    });

    addItemForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = itemNameInput.value.trim();
      const price = parseFloat(itemPriceInput.value);
      const img = itemImgInput.value.trim();
      const desc = itemDescInput.value.trim();

      if (!name || isNaN(price) || price < 0 || !img) {
        alert("براہ کرم نام، قیمت اور تصویر کا URL صحیح لکھیں۔");
        return;
      }

      const maxId = items.reduce((max, it) => (it.id > max ? it.id : max), 0);
      const newItem = {
        id: maxId + 1,
        name,
        price,
        img,
        desc
      };
      if (newItem.price <= 0) {
        if (!confirm("کیا آپ واقعی قیمت 0 رکھنا چاہتے ہیں؟ اگر آئٹم کے آپشنز ہیں تو براہ کرم ایڈمن پینل میں ایڈٹ کریں۔")) {
          return;
        }
      }
      
      items.push(newItem);
      saveItems();
      filteredItems = [...items];
      renderItemsList();
      renderMenu(filteredItems);

      addItemForm.reset();
      alert("نیا آئٹم add ہو گیا!");
    });

    changeImageInput.addEventListener("change", (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file || !currentImageChangeItemId) {
        changeImageInput.value = "";
        return;
      }

      const reader = new FileReader();
      reader.onload = (ev) => {
        const dataUrl = ev.target.result;
        const item = getItem(currentImageChangeItemId);
        if (item) {
          item.img = dataUrl;
          saveItems();
          filteredItems = [...items];
          renderItemsList();
          renderMenu(filteredItems);
          if (String(currentModalItemId) === String(currentImageChangeItemId)) {
              modalImg.src = dataUrl;
          }
          alert("تصویر اپڈیٹ ہو گئی!");
        }
        currentImageChangeItemId = null;
        changeImageInput.value = "";
      };
      reader.readAsDataURL(file);
    });

    filteredItems = [...items];
    renderMenu(filteredItems);
    updateTodaySalesBadge();
  </script>
</body>
</html>
