<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>SPA E-commerce Template</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --blue-bg: #dbeafe;
        --blue-main: #1d4ed8;
        --blue-light: #eff6ff;
        --red-soft: #fee2e2;
        --red: #ef4444;
        --text: #0f172a;
        --muted: #6b7280;
        --border: #bfdbfe;
        --radius: 14px;
        --shadow: 0 14px 30px rgba(15, 23, 42, 0.35);
      }
      *{box-sizing:border-box;}
      html,body{margin:0;padding:0;height:100%;overflow:hidden;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:radial-gradient(circle at top left,#bfdbfe,#dbeafe);color:var(--text);}
      button,input,select{font-family:inherit;}
      img{display:block;max-width:100%;}
      .app{height:100vh;display:flex;flex-direction:column;padding:8px;}
      .shell{flex:1;border-radius:var(--radius);background:linear-gradient(135deg,var(--blue-main),#2563eb);box-shadow:var(--shadow);border:1px solid #1e40af;display:flex;flex-direction:column;overflow:hidden;}
      .topbar{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;border-bottom:1px solid rgba(191,219,254,.6);background:linear-gradient(90deg,#1d4ed8,#2563eb);color:#eff6ff;}
      .logo{display:flex;align-items:center;gap:6px;}
      .logo-b{width:30px;height:30px;border-radius:999px;background:#eff6ff;color:#1d4ed8;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;box-shadow:0 0 0 1px #bfdbfe,0 8px 20px rgba(15,23,42,.4);}
      .logo-t{font-size:13px;font-weight:600;letter-spacing:-.03em;}
      .logo-s{font-size:10px;color:#dbeafe;}
      .top-mid{flex:1;display:flex;justify-content:center;}
      .search-wrap{position:relative;width:100%;max-width:320px;}
      .search-i{width:100%;border-radius:999px;border:1px solid #bfdbfe;background:#eff6ff;color:var(--text);padding:7px 10px 7px 26px;font-size:12px;}
      .search-i::placeholder{color:#9ca3af;}
      .search-ic{position:absolute;left:8px;top:50%;transform:translateY(-50%);font-size:11px;color:#60a5fa;}
      .top-act{display:flex;align-items:center;gap:6px;}
      .btn{border-radius:999px;border:1px solid transparent;background:rgba(239,246,255,.9);color:#1d4ed8;font-size:11px;padding:5px 10px;display:inline-flex;align-items:center;gap:4px;cursor:pointer;transition:.16s;}
      .btn:hover{transform:translateY(-1px);}
      .btn-g{background:transparent;color:#eff6ff;border-color:rgba(191,219,254,.6);}
      .btn-g:hover{background:rgba(15,23,42,.18);border-color:#bfdbfe;}
      .btn-a{background:#f97316;color:#fff;border-color:#ea580c;}
      .btn-a:hover{background:#c2410c;}
      .btn-i{width:30px;height:30px;padding:0;border-radius:999px;}
      .cart-badge{position:relative;font-size:13px;}
      .cart-count{position:absolute;top:-5px;right:-6px;font-size:9px;background:var(--red);color:#fff;border-radius:999px;padding:0 4px;border:1px solid #fee2e2;}
      .content{flex:1;display:flex;overflow:hidden;background:linear-gradient(135deg,#bfdbfe,#eff6ff);}
      .side{width:130px;border-right:1px solid var(--border);background:#eff6ff;padding:8px;display:flex;flex-direction:column;gap:6px;}
      .side-title{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.09em;margin-bottom:2px;}
      .nav{font-size:11px;border-radius:999px;border:1px solid transparent;padding:5px 8px;color:var(--muted);cursor:pointer;display:flex;align-items:center;gap:6px;background:transparent;transition:.16s;}
      .nav-dot{width:6px;height:6px;border-radius:999px;background:#bfdbfe;}
      .nav.active{background:#1d4ed8;border-color:#1d4ed8;color:#eff6ff;}
      .nav.active .nav-dot{background:#eff6ff;}
      .nav:hover{background:#e0f2fe;color:#1d4ed8;border-color:#bfdbfe;}
      #nav-admin{display:none;}
      .main{flex:1;display:flex;flex-direction:column;padding:8px;overflow:hidden;}
      .view{display:none;flex:1;border-radius:12px;border:1px solid var(--border);background:#eff6ff;padding:8px;overflow:hidden;}
      .view.active{display:flex;}
      .view-inner{flex:1;display:flex;flex-direction:column;overflow:hidden;}
      .vh{display:flex;align-items:center;justify-content:space-between;font-size:11px;margin-bottom:4px;}
      .vh-title{font-weight:600;color:#111827;}
      .vh-sub{color:var(--muted);}
      .pill{font-size:9px;border-radius:999px;border:1px solid var(--border);padding:2px 8px;background:#fff;color:var(--muted);}
      .prod-wrap{flex:1;border-radius:10px;border:2px solid var(--red);padding:6px;background:#fef2f2;display:flex;flex-direction:column;overflow:hidden;}
      .prod-grid{flex:1;display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:6px;}
      .p-card{position:relative;border-radius:9px;border:1px solid #fecaca;background:#fff;padding:4px;font-size:10px;display:flex;flex-direction:column;gap:3px;cursor:pointer;box-shadow:0 4px 10px rgba(248,113,113,.16);transition:.16s;}
      .p-card::before{content:"";position:absolute;top:0;left:0;width:12px;height:4px;background:var(--red);border-radius:9px 0 9px 0;}
      .p-card:hover{transform:translateY(-1px);box-shadow:0 9px 16px rgba(248,113,113,.3);border-color:var(--red);}
      .p-img-box{border-radius:7px;overflow:hidden;background:var(--red-soft);height:58px;display:flex;align-items:center;justify-content:center;}
      .p-img-box img{width:100%;height:100%;object-fit:cover;}
      .p-name{font-size:10px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:#111827;}
      .p-row{display:flex;justify-content:space-between;align-items:center;}
      .p-price{font-size:10px;font-weight:600;color:#b91c1c;}
      .p-tag{font-size:9px;color:var(--muted);}
      .p-badge{position:absolute;top:4px;right:4px;font-size:9px;padding:1px 5px;border-radius:999px;background:var(--red);color:#fef2f2;border:1px solid #fee2e2;}
      .p-footer{margin-top:2px;display:flex;justify-content:space-between;align-items:center;}
      .p-stock{font-size:9px;color:var(--muted);}
      .p-add{border-radius:999px;border:1px solid var(--red);background:#fecaca;color:#7f1d1d;font-size:9px;padding:2px 7px;cursor:pointer;transition:.16s;}
      .p-add:hover{background:var(--red);border-color:#b91c1c;color:#fff;transform:translateY(-.5px);}
      .cart-layout{flex:1;display:flex;gap:6px;overflow:hidden;}
      .cart-col{flex:1;border-radius:9px;border:1px solid var(--border);background:#fff;padding:6px;display:flex;flex-direction:column;overflow:hidden;}
      .cart-list{flex:1;overflow:hidden;}
      .cart-empty{font-size:11px;color:var(--muted);}
      .cart-item{display:grid;grid-template-columns:32px 1fr auto;gap:6px;font-size:10px;padding:4px 0;border-bottom:1px dashed #e5e7eb;}
      .cart-item:last-child{border-bottom:none;}
      .cart-thumb{width:32px;height:32px;border-radius:6px;overflow:hidden;background:var(--red-soft);}
      .cart-name{font-size:10px;font-weight:500;color:#111827;}
      .cart-meta{font-size:9px;color:var(--muted);}
      .cart-qty-row{margin-top:2px;display:flex;gap:4px;align-items:center;}
      .cart-qty-btn{width:16px;height:16px;border-radius:999px;border:1px solid #e5e7eb;background:#eff6ff;color:#111827;font-size:10px;cursor:pointer;}
      .cart-qty-val{min-width:16px;text-align:center;font-size:9px;}
      .cart-rem{font-size:9px;color:#b91c1c;border:none;background:transparent;cursor:pointer;}
      .cart-total-cell{font-size:10px;font-weight:600;text-align:right;color:#b91c1c;}
      .sum-row{display:flex;justify-content:space-between;font-size:10px;margin-bottom:3px;}
      .sum-row strong{font-weight:600;}
      .sum-main{padding-top:4px;margin-top:4px;border-top:1px dashed #e5e7eb;}
      .sum-note{font-size:9px;color:var(--muted);margin-top:4px;}
      .co-form{flex:1;display:flex;flex-direction:column;justify-content:space-between;font-size:11px;}
      .co-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:6px;}
      .field{display:flex;flex-direction:column;gap:2px;}
      .field-l{font-size:10px;color:var(--muted);}
      .field-i{border-radius:7px;border:1px solid #e5e7eb;background:#f9fafb;color:#111827;font-size:11px;padding:4px 6px;}
      .field-i::placeholder{color:#9ca3af;}
      .small{font-size:9px;color:var(--muted);margin-top:4px;}
      .admin-layout{flex:1;display:flex;gap:6px;overflow:hidden;}
      .admin-col{flex:1;border-radius:9px;border:1px solid var(--border);background:#fff;padding:6px;display:flex;flex-direction:column;overflow:hidden;}
      .admin-label{font-size:10px;color:var(--muted);margin-bottom:3px;}
      .admin-table{flex:1;overflow-y:auto;scrollbar-width:thin;}
      .admin-row{display:grid;grid-template-columns:1.2fr .7fr .7fr;gap:4px;font-size:10px;padding:3px 0;border-bottom:1px dashed #e5e7eb;}
      .admin-row:last-child{border-bottom:none;}
      .admin-input{border-radius:6px;border:1px solid #e5e7eb;background:#f9fafb;color:#111827;font-size:10px;padding:3px 4px;width:100%;}
      .admin-note{font-size:9px;color:var(--muted);margin-top:3px;}
      .admin-form{display:flex;flex-direction:column;gap:4px;font-size:10px;}
      .modal{position:fixed;inset:0;background:rgba(15,23,42,.65);display:none;align-items:center;justify-content:center;z-index:40;}
      .modal.active{display:flex;}
      .modal-box{max-width:80vw;max-height:80vh;border-radius:12px;overflow:hidden;border:2px solid var(--red);background:#fff;box-shadow:0 18px 40px rgba(0,0,0,.7);position:relative;}
      .modal-box img{width:100%;height:100%;object-fit:contain;}
      .modal-close{position:absolute;top:6px;right:6px;border-radius:999px;border:1px solid #e5e7eb;background:#fff;color:#111827;padding:2px 8px;font-size:11px;cursor:pointer;}
      @media(max-width:768px){
        .side{display:none;}
        .cart-layout,.admin-layout{flex-direction:column;}
        .co-grid{grid-template-columns:minmax(0,1fr);}
      }
    </style>
  </head>
  <body>
    <div class="app">
      <div class="shell">
        <header class="topbar">
          <div class="logo">
            <div class="logo-b">SPA</div>
            <div>
              <div class="logo-t">E-commerce SPA</div>
              <div class="logo-s">Single file</div>
            </div>
          </div>
          <div class="top-mid">
            <div class="search-wrap">
              <span class="search-ic">üîç</span>
              <input id="search" class="search-i" type="text" placeholder="Search products..." />
            </div>
          </div>
          <div class="top-act">
            <button class="btn btn-g" type="button" data-view="home">Home</button>
            <button class="btn btn-g" type="button" data-view="products">Products</button>
            <button class="btn btn-i btn-g" type="button" data-view="cart">
              <span class="cart-badge">üõí<span id="cart-count" class="cart-count">0</span></span>
            </button>
          </div>
        </header>

        <div class="content">
          <aside class="side">
            <div class="side-title">Views</div>
            <button class="nav active" data-view="home"><span class="nav-dot"></span><span>Overview</span></button>
            <button class="nav" data-view="products"><span class="nav-dot"></span><span>Catalog</span></button>
            <button class="nav" data-view="cart"><span class="nav-dot"></span><span>Cart</span></button>
            <button class="nav" data-view="checkout"><span class="nav-dot"></span><span>Checkout</span></button>
            <button class="nav" data-view="admin" id="nav-admin"><span class="nav-dot"></span><span>Admin</span></button>
          </aside>

          <main class="main">
            <!-- HOME -->
            <section class="view active" id="view-home">
              <div class="view-inner">
                <div class="vh">
                  <div>
                    <div class="vh-title">Store overview</div>
                    <div class="vh-sub">Single page with 10 products and cart.</div>
                  </div>
                  <div class="pill">SPA ¬∑ no scroll</div>
                </div>
                <div class="prod-wrap">
                  <div class="vh-sub" style="font-size:10px;margin-bottom:4px;">Click image to enlarge or search above.</div>
                  <div id="grid-home" class="prod-grid"></div>
                </div>
              </div>
            </section>

            <!-- PRODUCTS -->
            <section class="view" id="view-products">
              <div class="view-inner">
                <div class="vh">
                  <div>
                    <div class="vh-title">Catalog</div>
                    <div class="vh-sub">Exactly 10 demo products.</div>
                  </div>
                  <div id="prod-count" class="pill">10 products</div>
                </div>
                <div class="prod-wrap">
                  <div id="prod-info" class="vh-sub" style="font-size:10px;margin-bottom:4px;">All products.</div>
                  <div id="grid-products" class="prod-grid"></div>
                </div>
              </div>
            </section>

            <!-- CART -->
            <section class="view" id="view-cart">
              <div class="view-inner">
                <div class="vh">
                  <div>
                    <div class="vh-title">Cart</div>
                    <div class="vh-sub">Review items.</div>
                  </div>
                  <div class="pill">Items: <span id="cart-pill">0</span></div>
                </div>
                <div class="cart-layout">
                  <div class="cart-col">
                    <div class="vh-sub" style="margin-bottom:4px;">Items</div>
                    <div id="cart-items" class="cart-list"></div>
                  </div>
                  <div class="cart-col">
                    <div class="vh-sub" style="margin-bottom:4px;">Summary</div>
                    <div>
                      <div class="sum-row"><span>Subtotal</span><span id="sum-sub">$0.00</span></div>
                      <div class="sum-row"><span>Tax (10%)</span><span id="sum-tax">$0.00</span></div>
                      <div class="sum-row"><span>Shipping</span><span id="sum-ship">$0.00</span></div>
                      <div class="sum-row sum-main"><strong>Total</strong><strong id="sum-total">$0.00</strong></div>
                      <p class="sum-note">Demo math only. Replace with real rules.</p>
                      <button class="btn btn-a" type="button" data-view="checkout" style="width:100%;margin-top:4px;">Checkout</button>
                      <button class="btn btn-g" type="button" id="btn-clear" style="width:100%;margin-top:4px;">Clear cart</button>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            <!-- CHECKOUT -->
            <section class="view" id="view-checkout">
              <div class="view-inner">
                <div class="vh">
                  <div>
                    <div class="vh-title">Checkout</div>
                    <div class="vh-sub">Minimal fields only.</div>
                  </div>
                  <div class="pill">Total: <span id="co-total">$0.00</span></div>
                </div>
                <div class="cart-layout">
                  <div class="cart-col">
                    <div class="vh-sub" style="margin-bottom:4px;">Details</div>
                    <form id="co-form" class="co-form">
                      <div class="co-grid">
                        <div class="field">
                          <label class="field-l" for="co-mobile">Mobile</label>
                          <input id="co-mobile" class="field-i" type="tel" required placeholder="+1 555 123..." />
                        </div>
                        <div class="field">
                          <label class="field-l" for="co-postal">Postal code</label>
                          <input id="co-postal" class="field-i" type="text" required placeholder="Postal" />
                        </div>
                        <div class="field">
                          <label class="field-l" for="co-house">House no.</label>
                          <input id="co-house" class="field-i" type="text" required placeholder="House" />
                        </div>
                        <div class="field">
                          <label class="field-l" for="co-street">Street</label>
                          <input id="co-street" class="field-i" type="text" required placeholder="Street" />
                        </div>
                      </div>
                      <div>
                        <p class="small">On submit this demo only shows an alert and clears the cart.</p>
                        <button class="btn btn-a" type="submit" style="width:100%;margin-top:4px;">Place order</button>
                      </div>
                    </form>
                  </div>
                  <div class="cart-col">
                    <div class="vh-sub" style="margin-bottom:4px;">Preview</div>
                    <div id="co-preview" class="cart-list"></div>
                  </div>
                </div>
              </div>
            </section>

            <!-- ADMIN (hidden, code 2004) -->
            <section class="view" id="view-admin">
              <div class="view-inner">
                <div class="vh">
                  <div>
                    <div class="vh-title">Admin (mock)</div>
                    <div class="vh-sub">Edit name/price, image & add placeholder products.</div>
                  </div>
                  <div class="pill">Owner only</div>
                </div>
                <div class="admin-layout">
                  <div class="admin-col">
                    <div class="admin-label">Products</div>
                    <div id="admin-table" class="admin-table"></div>
                    <div class="admin-note">Changes refresh the storefront immediately (in memory only).</div>
                    <button class="btn btn-g" type="button" data-view="home" style="margin-top:4px;">‚Üê Back</button>
                  </div>
                  <div class="admin-col">
                    <div class="admin-label">Image & add product</div>
                    <div class="admin-note">Upload uses FileReader and updates only in this session.</div>
                    <div class="admin-form" style="margin-top:4px;">
                      <div class="field">
                        <label class="field-l" for="adm-img-prod">Product</label>
                        <select id="adm-img-prod" class="admin-input"></select>
                      </div>
                      <div class="field">
                        <label class="field-l">Image file</label>
                        <input id="adm-img-file" type="file" class="admin-input" />
                      </div>
                      <button id="adm-img-save" class="btn btn-g" type="button">Save image</button>
                      <div id="adm-img-status" class="admin-note"></div>
                      <hr style="border:none;border-top:1px dashed #e5e7eb;margin:6px 0;" />
                      <div class="field">
                        <label class="field-l" for="adm-new-name">New name</label>
                        <input id="adm-new-name" class="admin-input" type="text" />
                      </div>
                      <div class="field">
                        <label class="field-l" for="adm-new-price">New price</label>
                        <input id="adm-new-price" class="admin-input" type="number" step="0.01" />
                      </div>
                      <button id="adm-add" class="btn btn-g" type="button">Add product (demo)</button>
                      <div class="admin-note">New products are stored in memory but main catalog always shows first 10 items.</div>
                    </div>
                  </div>
                </div>
              </div>
            </section>
          </main>
        </div>
      </div>
    </div>

    <!-- IMAGE MODAL -->
    <div id="modal" class="modal">
      <div class="modal-box">
        <button id="modal-close" class="modal-close" type="button">Close</button>
        <img id="modal-img" src="" alt="Product" />
      </div>
    </div>

    <script>
      const PRODUCTS=[
        {id:"p1",name:"Premium Wireless Headphones",desc:"Over-ear wireless headphones.",price:199,currency:"USD",stock:12,tag:"Audio",image:"https://via.placeholder.com/300x200/fee2e2/7f1d1d?text=Headphones"},
        {id:"p2",name:"Smartwatch Sport Edition",desc:"Fitness smartwatch.",price:149,currency:"USD",stock:20,tag:"Wearables",image:"https://via.placeholder.com/300x200/fee2e2/7f1d1d?text=Watch"},
        {id:"p3",name:"Minimalist Desk Lamp",desc:"LED desk lamp.",price:59,currency:"USD",stock:35,tag:"Home",image:"https://via.placeholder.com/300x200/fee2e2/7f1d1d?text=Lamp"},
        {id:"p4",name:"Ergonomic Office Chair",desc:"Adjustable chair.",price:249,currency:"USD",stock:5,tag:"Office",image:"https://via.placeholder.com/300x200/fee2e2/7f1d1d?text=Chair"},
        {id:"p5",name:"Cotton Oversized Hoodie",desc:"Unisex hoodie.",price:69,currency:"USD",stock:42,tag:"Fashion",image:"https://via.placeholder.com/300x200/fee2e2/7f1d1d?text=Hoodie"},
        {id:"p6",name:"Leather Crossbody Bag",desc:"Small leather bag.",price:129,currency:"USD",stock:18,tag:"Fashion",image:"https://via.placeholder.com/300x200/fee2e2/7f1d1d?text=Bag"},
        {id:"p7",name:"Wireless Mechanical Keyboard",desc:"Compact keyboard.",price:119,currency:"USD",stock:25,tag:"Electronics",image:"https://via.placeholder.com/300x200/fee2e2/7f1d1d?text=Keyboard"},
        {id:"p8",name:"Ceramic Coffee Mug Set",desc:"Set of 4 mugs.",price:39,currency:"USD",stock:60,tag:"Kitchen",image:"https://via.placeholder.com/300x200/fee2e2/7f1d1d?text=Mugs"},
        {id:"p9",name:"Noise Isolating Earbuds",desc:"In-ear earbuds.",price:49,currency:"USD",stock:50,tag:"Audio",image:"https://via.placeholder.com/300x200/fee2e2/7f1d1d?text=Earbuds"},
        {id:"p10",name:"Stainless Steel Bottle",desc:"Insulated bottle.",price:29,currency:"USD",stock:80,tag:"Outdoor",image:"https://via.placeholder.com/300x200/fee2e2/7f1d1d?text=Bottle"}
      ];
      const state={view:"home",query:"",cart:[],pendingImg:null};
      const views=["home","products","cart","checkout","admin"];
      const fmt=(v,c="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:c}).format(v);
      const getProduct=id=>PRODUCTS.find(p=>p.id===id);
      const filtered=()=>{
        let list=PRODUCTS.slice(0,10);
        const q=state.query.trim().toLowerCase();
        if(q&&q!=="2004"){
          list=list.filter(p=>p.name.toLowerCase().includes(q)||p.desc.toLowerCase().includes(q));
        }
        return list;
      };
      function switchView(v){
        if(!views.includes(v))return;
        state.view=v;
        document.querySelectorAll(".view").forEach(el=>{el.classList.toggle("active",el.id==="view-"+v);});
        document.querySelectorAll(".nav").forEach(btn=>{btn.classList.toggle("active",btn.dataset.view===v);});
        if(v==="home"){renderHome();}
        if(v==="products"){renderProducts();}
        if(v==="cart"){renderCart();}
        if(v==="checkout"){renderCheckout();}
        if(v==="admin"){renderAdmin();}
      }
      function productCard(p){
        const card=document.createElement("div");
        card.className="p-card";
        card.innerHTML=`
          <div class="p-img-box"><img src="${p.image}" alt="${p.name}"></div>
          <span class="p-badge">${p.tag}</span>
          <div class="p-name" title="${p.name}">${p.name}</div>
          <div class="p-row"><span class="p-price">${fmt(p.price,p.currency)}</span><span class="p-tag">${p.stock>0?p.stock+" in stock":"Out"}</span></div>
          <div class="p-footer"><span class="p-stock">Tap to enlarge</span><button class="p-add" type="button">Add</button></div>`;
        const img=card.querySelector("img");
        img.addEventListener("click",e=>{e.stopPropagation();openModal(p.image);});
        const addBtn=card.querySelector(".p-add");
        addBtn.addEventListener("click",e=>{e.stopPropagation();addToCart(p.id,1);});
        return card;
      }
      function renderHome(){
        const grid=document.getElementById("grid-home");
        grid.innerHTML="";
        filtered().forEach(p=>grid.appendChild(productCard(p)));
      }
      function renderProducts(){
        const grid=document.getElementById("grid-products");
        const count=document.getElementById("prod-count");
        const info=document.getElementById("prod-info");
        const list=filtered();
        grid.innerHTML="";
        list.forEach(p=>grid.appendChild(productCard(p)));
        count.textContent=list.length+" products";
        info.textContent=state.query&&state.query!=="2004"?"Filter: \""+state.query+"\"":"All products.";
      }
      const cartCount=()=>state.cart.reduce((a,c)=>a+c.q,0);
      const totals=()=>{
        let s=0;state.cart.forEach(i=>{const p=getProduct(i.id);if(p)s+=p.price*i.q;});
        const t=s*0.1;const sh=s>0&&s<200?9:0;return{sub:s,tax:t,ship:sh,tot:s+t+sh};
      };
      function addToCart(id,q){
        const i=state.cart.find(x=>x.id===id);
        if(i)i.q+=q;else state.cart.push({id,q});
        updateCartInfo();
        if(state.view==="cart")renderCart();
        if(state.view==="checkout")renderCheckout();
      }
      function updateCartInfo(){
        document.getElementById("cart-count").textContent=cartCount();
        document.getElementById("cart-pill").textContent=cartCount();
      }
      function renderCart(){
        const wrap=document.getElementById("cart-items");
        wrap.innerHTML="";
        if(!state.cart.length){const d=document.createElement("div");d.className="cart-empty";d.textContent="Cart is empty.";wrap.appendChild(d);}else{
          state.cart.forEach(it=>{
            const p=getProduct(it.id);if(!p)return;
            const row=document.createElement("div");
            row.className="cart-item";
            row.innerHTML=`
              <div class="cart-thumb"><img src="${p.image}" alt="${p.name}"></div>
              <div>
                <div class="cart-name">${p.name}</div>
                <div class="cart-meta">${fmt(p.price,p.currency)} each</div>
                <div class="cart-qty-row">
                  <button class="cart-qty-btn" data-a="dec">-</button>
                  <span class="cart-qty-val">${it.q}</span>
                  <button class="cart-qty-btn" data-a="inc">+</button>
                  <button class="cart-rem" data-a="rem" type="button">remove</button>
                </div>
              </div>
              <div class="cart-total-cell">${fmt(p.price*it.q,p.currency)}</div>`;
            row.querySelectorAll("[data-a]").forEach(btn=>{
              btn.addEventListener("click",()=>{
                const a=btn.dataset.a;
                if(a==="dec")it.q--;if(a==="inc")it.q++;if(a==="rem")it.q=0;
                state.cart=state.cart.filter(x=>x.q>0);
                updateCartInfo();renderCart();renderCheckout();
              });
            });
            wrap.appendChild(row);
          });
        }
        const {sub,tax,ship,tot}=totals();
        document.getElementById("sum-sub").textContent=fmt(sub);
        document.getElementById("sum-tax").textContent=fmt(tax);
        document.getElementById("sum-ship").textContent=fmt(ship);
        document.getElementById("sum-total").textContent=fmt(tot);
      }
      function renderCheckout(){
        const prev=document.getElementById("co-preview");
        const total=document.getElementById("co-total");
        prev.innerHTML="";
        if(!state.cart.length){const d=document.createElement("div");d.className="cart-empty";d.textContent="Cart is empty.";prev.appendChild(d);}else{
          state.cart.forEach(it=>{
            const p=getProduct(it.id);if(!p)return;
            const row=document.createElement("div");
            row.className="cart-item";
            row.innerHTML=`
              <div class="cart-thumb"><img src="${p.image}" alt="${p.name}"></div>
              <div>
                <div class="cart-name">${p.name}</div>
                <div class="cart-meta">Qty: ${it.q} ¬∑ ${fmt(p.price,p.currency)}</div>
              </div>
              <div class="cart-total-cell">${fmt(p.price*it.q,p.currency)}</div>`;
            prev.appendChild(row);
          });
        }
        total.textContent=fmt(totals().tot);
      }
      function renderAdmin(){
        const table=document.getElementById("admin-table");
        const select=document.getElementById("adm-img-prod");
        table.innerHTML="";select.innerHTML="";
        PRODUCTS.forEach(p=>{
          const row=document.createElement("div");
          row.className="admin-row";
          row.innerHTML=`
            <div><div class="admin-label">Name</div><input class="admin-input" data-f="name" value="${p.name}"></div>
            <div><div class="admin-label">Price</div><input class="admin-input" data-f="price" type="number" step="0.01" value="${p.price}"></div>
            <div><div class="admin-label">Tag</div><input class="admin-input" data-f="tag" value="${p.tag}"></div>`;
          row.querySelectorAll(".admin-input").forEach(inp=>{
            inp.addEventListener("input",()=>{
              const f=inp.dataset.f;
              if(f==="price")p.price=parseFloat(inp.value||"0");
              if(f==="name")p.name=inp.value;
              if(f==="tag")p.tag=inp.value;
              renderHome();renderProducts();renderCart();renderCheckout();
            });
          });
          table.appendChild(row);
          const opt=document.createElement("option");
          opt.value=p.id;opt.textContent=p.name;select.appendChild(opt);
        });
      }
      function bindAdmin(){
        const file=document.getElementById("adm-img-file");
        const select=document.getElementById("adm-img-prod");
        const save=document.getElementById("adm-img-save");
        const status=document.getElementById("adm-img-status");
        const addBtn=document.getElementById("adm-add");
        const newName=document.getElementById("adm-new-name");
        const newPrice=document.getElementById("adm-new-price");
        file.addEventListener("change",()=>{
          const f=file.files[0];
          if(!f){state.pendingImg=null;status.textContent="";return;}
          const reader=new FileReader();
          reader.onload=e=>{
            state.pendingImg={id:select.value,data:e.target.result};
            status.textContent="Ready to save.";
          };
          reader.readAsDataURL(f);
        });
        save.addEventListener("click",()=>{
          if(!state.pendingImg||!state.pendingImg.data){alert("Select a file first.");return;}
          const p=getProduct(state.pendingImg.id);
          if(!p){alert("Product not found.");return;}
          p.image=state.pendingImg.data;
          state.pendingImg=null;file.value="";status.textContent="Image saved for this session.";
          renderHome();renderProducts();renderCart();renderCheckout();
        });
        addBtn.addEventListener("click",()=>{
          const n=newName.value.trim();
          const pr=parseFloat(newPrice.value||"0");
          if(!n||!pr){alert("Enter name and price.");return;}
          PRODUCTS.push({id:"n"+Date.now(),name:n,desc:"Admin-created item.",price:pr,currency:"USD",stock:0,tag:"New",image:"https://via.placeholder.com/300x200/fee2e2/7f1d1d?text=New"});
          alert("Placeholder product added (memory only, grid still shows first 10).");
          newName.value="";newPrice.value="";
          renderAdmin();renderHome();renderProducts();
        });
      }
      function openModal(src){
        document.getElementById("modal-img").src=src;
        document.getElementById("modal").classList.add("active");
      }
      function closeModal(){document.getElementById("modal").classList.remove("active");}
      function bindUI(){
        document.querySelectorAll("[data-view]").forEach(btn=>{
          btn.addEventListener("click",()=>{switchView(btn.dataset.view);});
        });
        document.querySelectorAll(".nav").forEach(btn=>{
          btn.addEventListener("click",()=>{switchView(btn.dataset.view);});
        });
        const s=document.getElementById("search");
        s.addEventListener("keyup",e=>{
          const v=s.value.trim();
          if(v==="2004"){
            s.value="";state.query="";document.getElementById("nav-admin").style.display="block";switchView("admin");return;
          }
          state.query=v;renderHome();renderProducts();
        });
        document.getElementById("btn-clear").addEventListener("click",()=>{
          if(confirm("Clear cart?")){state.cart=[];updateCartInfo();renderCart();renderCheckout();}
        });
        document.getElementById("co-form").addEventListener("submit",e=>{
          e.preventDefault();
          if(!state.cart.length){alert("Cart is empty.");return;}
          const m=document.getElementById("co-mobile").value;
          const p=document.getElementById("co-postal").value;
          const h=document.getElementById("co-house").value;
          const st=document.getElementById("co-street").value;
          alert("Order placed (demo).\nMobile: "+m+"\nPostal: "+p+"\nHouse: "+h+"\nStreet: "+st);
          state.cart=[];updateCartInfo();renderCart();renderCheckout();
        });
        document.getElementById("modal").addEventListener("click",e=>{if(e.target.id==="modal")closeModal();});
        document.getElementById("modal-close").addEventListener("click",closeModal);
      }
      function init(){
        bindUI();bindAdmin();renderHome();renderProducts();renderCart();renderCheckout();renderAdmin();updateCartInfo();
      }
      document.addEventListener("DOMContentLoaded",init);
    </script>
  </body>
</html>
