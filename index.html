<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fish & Chips | Premium Menu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    /* ========= THEME COLORS (RED/GOLD/BLUE-BG) ========= */
    :root {
      --primary-red: #cc0000;
      --red-dark: #8c0000;
      --yellow-gold: #ffcc00;
      --yellow-light: #fff5e0;
      --blue-bg: #d9e9ff; 
      --card-bg: #fff5e0;
      --text-main: #332b00;
      --text-muted: #665b26;
      --search-bg: #ffffff;
      --radius-lg: 12px;
      --shadow-soft: 0 5px 15px rgba(0, 0, 0, 0.08);
      --shadow-deep: 0 15px 35px rgba(0, 0, 0, 0.2);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Poppins', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: var(--blue-bg);
      color: var(--text-main);
      overflow: hidden;
    }

    .page {
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ========= HEADER (FIXED & RED) ========= */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 20;
      background: linear-gradient(135deg, var(--red-dark), var(--primary-red));
      color: #ffffff;
      padding: 12px 16px 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .header-inner {
      max-width: 1100px;
      margin: 0 auto;
    }

    /* NEW FIX: Ensure main rows stack correctly */
    .brand-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 6px;
    }

    .brand-title-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .brand-main {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .scroll-arrow {
      font-size: 20px;
      color: var(--yellow-gold);
      transform: rotate(0deg);
      transition: transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.3s;
      opacity: 0;
      visibility: hidden;
    }

    .scrolling .scroll-arrow {
      opacity: 1;
      visibility: visible;
      animation: rotateArrow 4s linear infinite;
    }

    @keyframes rotateArrow {
      from { transform: rotate(0deg); }
      to   { transform: rotate(360deg); }
    }

    .brand-name {
      font-size: 26px;
      font-weight: 800;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .brand-tagline {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: #ffe0e0;
    }

    .header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
    }

    .today-sales {
      font-size: 13px;
      padding: 6px 12px;
      border-radius: 999px;
      background: var(--yellow-gold);
      color: var(--red-dark);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
      backdrop-filter: blur(4px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      display: none; /* HIDDEN ON PUBLIC VIEW */
    }
    
    .delivery-status-badge {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.4);
      color: #fff5e0;
      white-space: nowrap;
    }

    .delivery-status-badge.off {
      background: rgba(0, 0, 0, 0.35);
      border-color: rgba(255, 255, 255, 0.25);
    }

    .header-cart {
      margin-top: 2px;
    }

    .cart-icon-btn {
      position: relative;
      border: none;
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 11px;
      font-weight: 600;
      background: #ffffff;
      color: var(--red-dark);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.25);
    }

    .cart-icon-btn .cart-circle {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: var(--primary-red);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
    }

    .cart-icon-btn .cart-text {
      white-space: nowrap;
    }

    @keyframes cartBump {
      0%   { transform: scale(1); }
      30%  { transform: scale(1.08); }
      70%  { transform: scale(0.97); }
      100% { transform: scale(1); }
    }

    .cart-bump {
      animation: cartBump 0.35s.ease-out;
    }

    .search-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 4px;
    }

    .search-box {
      flex: 1;
      background: var(--search-bg);
      border-radius: 999px;
      padding: 8px 14px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.08);
    }

    .search-icon {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      border: 2px solid var(--text-main);
      position: relative;
    }

    .search-icon::after {
      content: "";
      width: 8px;
      height: 2px;
      border-radius: 999px;
      background: var(--text-main);
      position: absolute;
      right: -4px;
      bottom: -1px;
      transform: rotate(40deg);
    }

    #searchInput {
      border: none;
      outline: none;
      background: transparent;
      color: var(--text-main);
      font-size: 14px;
      width: 100%;
    }

    #searchInput::placeholder {
      color: var(--text-muted);
      opacity: 0.8;
    }

    .search-message {
      margin-top: 4px;
      font-size: 11px;
      color: #ffe0e0;
      background: rgba(0,0,0,0.18);
      padding: 4px 10px;
      border-radius: 999px;
      display: inline-block;
      max-width: 100%;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    /* ========= MAIN ========= */
    main {
      flex: 1;
      padding: 16px;
      padding-top: 155px; /* Adjust for taller header */
      padding-bottom: 50px;
      overflow-y: auto;
      background-image:
        url('data:image/svg+xml;utf8,<svg width="100%" height="100%" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><rect width="100%" height="100%" fill="none"/><g opacity="0.08" transform="translate(10, 10)"><rect x="0" y="0" width="180" height="180" fill="white"/><path d="M 0,0 L 180,90 L 0,180 Z" fill="%23cc0000"/></g></svg>'),
        url('data:image/svg+xml;utf8,<svg width="100%" height="100%" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect width="100%" height="100%" fill="none"/><path d="M 0,50 L 100,50 M 50,0 L 50,100" stroke="%23cc0000" stroke-width="2" opacity="0.1"/></svg>');
      background-size: cover, 100% 100%;
      background-repeat: no-repeat, no-repeat;
    }

    .content {
      max-width: 1100px;
      margin: 0 auto;
    }

    .section-title {
      margin-bottom: 15px;
      font-size: 22px;
      font-weight: 700;
      color: var(--red-dark);
      border-left: 5px solid var(--primary-red);
      padding-left: 10px;
      margin-top: 25px; 
    }

    .no-results {
      margin-top: 20px;
      padding: 14px 16px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.8);
      box-shadow: var(--shadow-soft);
      font-size: 14px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    /* ========= MENU CARDS ========= */
    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 20px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 22px;
      box-shadow: var(--shadow-soft);
      overflow: hidden;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      position: relative;
      transition:
        transform 0.25s cubic-bezier(0.2, 0.8, 0.2, 1),
        box-shadow 0.25s ease-out;
    }

    .card:hover {
      transform: translateY(-6px) scale(1.03);
      box-shadow: 0 16px 32px rgba(0, 0, 0, 0.2);
    }

    .card-img-wrapper {
      width: 100%;
      aspect-ratio: 4 / 3;
      overflow: hidden;
      background: var(--yellow-light);
    }

    .card-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transition: transform 0.3s.ease-out;
    }

    .card:hover .card-img {
      transform: scale(1.05);
    }

    .card-body {
      padding: 10px 12px 12px;
      background: var(--yellow-light);
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
      color: var(--red-dark);
    }

    .card-name {
      font-size: 14px;
      font-weight: 700;
    }

    .card-desc {
      font-size: 11px;
      color: var(--text-muted);
      line-height: 1.3;
      min-height: 26px;
    }

    .card-price {
      font-size: 13px;
      color: var(--primary-red);
      font-weight: 800;
      margin-top: 2px;
    }

    .add-to-cart-btn {
      position: absolute;
      bottom: 0;
      right: 0;
      background: var(--primary-red);
      color: var(--yellow-gold);
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 16px 0 0 0;
      font-size: 20px;
      cursor: pointer;
      line-height: 1;
      transition: background 0.4s, transform 0.4s;
      z-index: 5;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .add-to-cart-btn:hover {
      background: var(--red-dark);
      transform: scale(1.05);
    }

    /* ========= FLY DOT ANIMATION ========= */
    .fly-dot {
      position: fixed;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--primary-red);
      z-index: 50;
      pointer-events: none;
      transform: translate(0, 0);
      opacity: 1;
      /* SLOWER ANIMATION */
      transition:
        transform 0.8s cubic-bezier(0.5, 0.2, 0.3, 1),
        opacity 0.8s.ease-out;
    }

    /* ========= MODAL ========= */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 30;
      padding: 20px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s.ease-out;
    }

    .modal-backdrop.show {
      opacity: 1;
      pointer-events: auto;
    }

    .modal {
      background: transparent;
      border-radius: 28px;
      max-width: 450px;
      width: 100%;
      overflow: visible;
      display: flex;
      flex-direction: column;
      transform: translateY(40px) scale(0.9);
      opacity: 0;
      /* SLOWER ANIMATION */
      transition:
        transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1),
        opacity 0.5s.ease-out;
    }

    .modal-backdrop.show .modal {
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    .modal-img-wrapper {
      width: 220px;
      height: 220px;
      margin: 0 auto;
      border-radius: 50%;
      overflow: hidden;
      border: 6px solid rgba(255, 255, 255, 0.9);
      box-shadow: var(--shadow-deep);
      background: var(--yellow-light);
    }

    .modal-body {
      position: relative;
      margin: -26px 12px 0;
      padding: 20px 18px 16px;
      background: linear-gradient(135deg,
        rgba(255, 240, 200, 0.96),
        rgba(255, 208, 150, 0.9));
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.6);
      border-radius: 22px;
      box-shadow: var(--shadow-deep);
    }

    .modal-title-row {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }

    .modal-name {
      font-size: 1odorex;
      font-weight: 800;
      color: var(--red-dark);
    }

    .modal-price {
      font-size: 18px;
      font-weight: 800;
      color: var(--primary-red);
      white-space: nowrap;
    }

    .modal-options-group {
      margin-bottom: 10px;
      padding-top: 6px;
    }

    .option-radio {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--card-bg);
      padding: 8px 12px;
      border-radius: 10px;
      margin-bottom: 8px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.2s;
      font-size: 13px;
    }

    .option-radio.selected {
      border-color: var(--primary-red);
      background: var(--yellow-light);
      box-shadow: 0 0 0 2px rgba(204, 0, 0, 0.12);
    }

    .option-name {
      font-weight: 600;
      color: var(--text-main);
    }

    .option-price {
      font-weight: 800;
      color: var(--primary-red);
    }

    .modal-desc {
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.4;
      margin-bottom: 14px;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 4px;
      flex-wrap: wrap;
    }

    /* ========= BUTTONS ========= */
    .btn {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition:
        background 0.2s ease-out,
        transform 0.15s ease-out,
        box-shadow 0.2s.ease-out;
    }

    .btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: none;
    }

    .btn-primary {
      background: var(--primary-red);
      color: #ffffff;
      box-shadow: 0 10px 20px rgba(204, 0, 0, 0.35);
    }

    .btn-primary:hover {
      background: var(--red-dark);
      box-shadow: 0 14px 26px rgba(204, 0, 0, 0.55);
    }

    .btn-ghost {
      background: transparent;
      color: var(--red-dark);
      border: 1px solid rgba(140, 0, 0, 0.25);
    }

    .btn-ghost:hover {
      background: rgba(255, 255, 255, 0.6);
    }

    .btn-xs {
      padding: 4px 8px;
      font-size: 11px;
    }

    /* ========= ADMIN PANEL ========= */
    .admin-panel {
      position: fixed;
      top: 0;
      right: -360px;
      width: 340px;
      max-width: 90vw;
      height: 100vh;
      background: linear-gradient(160deg, #3a0d0d, #8c0000);
      color: #fff5e0;
      box-shadow: -8px 0 24px rgba(0, 0, 0, 0.35);
      z-index: 40;
      display: flex;
      flex-direction: column;
      transition: right 0.35s.ease-out;
    }

    .admin-header {
      padding: 14px 16px 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.15);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .admin-title {
      font-weight: 700;
      font-size: 17px;
    }

    .admin-pin {
      font-size: 11px;
      opacity: 0.85;
    }

    .admin-body {
      padding: 10px 14px 16px;
      overflow-y: auto;
      font-size: 13px;
    }

    .admin-section-title {
      margin: 10px 0 6px;
      padding-bottom: 4px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.16);
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 13px;
    }

    .field-group {
      margin-bottom: 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field-label {
      font-size: 12px;
      opacity: 0.9;
    }

    .field-input {
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.4);
      padding: 6px 10px;
      background: rgba(0, 0, 0, 0.15);
      color: #ffffff;
      font-size: 13px;
      outline: none;
    }

    .field-input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    .field-input:focus {
      border-color: var(--yellow-gold);
      box-shadow: 0 0 0 1px rgba(255, 204, 0, 0.7);
    }

    .admin-note {
      font-size: 11px;
      margin: 4px 0 10px;
      opacity: 0.85;
      line-height: 1.4;
    }

    .items-list {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .items-row {
      padding: 6px 8px;
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.25);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }
    
    .item-section-divider {
      background: rgba(255, 255, 255, 0.15);
      color: var(--yellow-gold);
      padding: 4px 8px;
      margin-top: 10px;
      margin-bottom: -4px;
      border-radius: 4px;
      font-weight: bold;
      text-transform: uppercase;
      font-size: 11px;
      border-left: 3px solid var(--yellow-gold);
    }

    /* ========= FOOTER ========= */
    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 8px 10px;
      background: var(--card-bg);
      font-size: 12px;
      color: var(--text-muted);
      box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1);
      z-index: 10;
    }

    .footer-inner {
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* HIDDEN CART HTML */
    .cart-drawer { display: none !important; }

    @media (max-width: 720px) {
      main {
        padding: 14px 10px 50px;
        padding-top: 155px;
      }
      /* NEW FIX: Ensure elements remain visible and centered on mobile */
      .brand-row {
        flex-direction: row; /* Keep elements side-by-side on mobile */
        align-items: center;
      }
      .brand-title-group {
        flex: 1; /* Allow brand name to take space */
        flex-direction: column;
        align-items: flex-start;
      }
      .header-right {
        align-items: flex-end;
      }
      .search-row {
        margin-top: 8px;
      }
      .brand-main {
        gap: 4px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="header-inner">
        <div class="brand-row">
          <div class="brand-title-group">
            <div class="brand-main">
              <div class="scroll-arrow">⟳</div>
              <div class="brand-name">Fish &amp; Chips</div>
            </div>
            <div class="brand-tagline">Fresh • Fast • Tasty • Halal</div>
          </div>

          <div class="header-right">
            <div class="today-sales" id="todaySalesBadge">
              <span class="badge-dot"></span>
              <span>Today: £0.00</span>
            </div>
            <div id="deliveryStatusBadge" class="delivery-status-badge">Collection only today</div>
            <div class="header-cart">
              <button id="cartButton" class="cart-icon-btn">
                <span class="cart-circle" id="cartBubbleCount">0</span>
                <span class="cart-text" id="cartBubbleText">£0.00</span>
              </button>
            </div>
          </div>
        </div>

        <div class="search-row">
          <div class="search-box">
            <div class="search-icon"></div>
            <input
              id="searchInput"
              type="text"
              placeholder="Search menu or type 2004 for admin..."
              autocomplete="off"
            />
          </div>
        </div>
        <div id="searchMessage" class="search-message" style="display:none;"></div>
      </div>
    </header>

    <main id="mainContent">
      <div class="content">
        <div id="menuContent"></div>
        <div id="noResults" class="no-results" style="display:none;">
          No items found. Try another search or add new items from the admin panel.
        </div>
      </div>
    </main>

    <footer>
      <div class="footer-inner">
        © <span id="year"></span> Fish &amp; Chips
      </div>
    </footer>
  </div>

  <div id="itemModalBackdrop" class="modal-backdrop">
    <div class="modal">
      <div class="modal-img-wrapper">
        <img id="modalImg" class="modal-img" src="" alt="" />
      </div>
      <div class="modal-body">
        <div class="modal-title-row">
          <div class="modal-name" id="modalName">Item name</div>
          <div class="modal-price" id="modalPrice">£0.00</div>
        </div>

        <div class="modal-options-group" id="optionsGroup" style="display:none;"></div>

        <div class="modal-desc" id="modalDesc">Description here...</div>

        <div class="modal-footer">
          <button class="btn btn-ghost" id="modalCloseBtn">Close</button>
          <button class="btn btn-primary" id="modalCollectionBtn">Collection</button>
          <button class="btn btn-primary" id="modalDeliveryBtn">Delivery</button>
          <button class="btn btn-primary" id="modalAddBtn">Add to cart</button>
        </div>
      </div>
    </div>
  </div>

  <aside id="adminPanel" class="admin-panel">
    <div class="admin-header">
      <div>
        <div class="admin-title">Admin Panel</div>
        <div class="admin-pin">Unlocked with PIN: 2004</div>
      </div>
      <button class="btn btn-outline btn-xs" id="adminCloseBtn">Close</button>
    </div>
    <div class="admin-body">
      <div class="admin-section-title">
        <span>Today's sales</span>
      </div>
      <div class="field-group">
        <label class="field-label" for="todaySalesInput">
          Enter total for today (£)
        </label>
        <input
          id="todaySalesInput"
          type="number"
          min="0"
          step="0.01"
          class="field-input"
          placeholder="e.g. 250.50"
        />
      </div>
      <button class="btn btn-primary btn-xs" id="saveSalesBtn">Save today total</button>
      <div id="todayBreakdown" class="admin-note">
        Total: £0.00 • 7%: £0.00 • 93%: £0.00
      </div>

      <div class="admin-section-title">
        <span>Delivery settings</span>
      </div>
      <div class="field-group">
        <label class="field-label">
          <input type="checkbox" id="deliveryEnabledInput" />
          &nbsp;Delivery available today
        </label>
      </div>
      <div class="field-group">
        <label class="field-label" for="deliveryChargeInput">Delivery charge (£)</label>
        <input
          id="deliveryChargeInput"
          type="number"
          step="0.01"
          min="0"
          class="field-input"
          placeholder="e.g. 3.00"
        />
      </div>
      <button class="btn btn-primary btn-xs" id="saveDeliveryBtn">Save delivery settings</button>

      <div class="admin-section-title">
        <span>Add new item</span>
      </div>
      <form id="addItemForm">
        <div class="field-group">
          <label class="field-label" for="itemNameInput">Name</label>
          <input
            id="itemNameInput"
            type="text"
            class="field-input"
            placeholder="e.g. Chicken Burger"
            required
          />
        </div>
        <div class="field-group">
          <label class="field-label" for="itemPriceInput">Single Price (£)</label>
          <input
            id="itemPriceInput"
            type="number"
            step="0.01"
            min="0"
            class="field-input"
            placeholder="e.g. 5.99"
          />
        </div>

        <div class="field-group">
          <label class="field-label" for="sizeOptionsString">Options (Name:Price, Name:Price)</label>
          <input
            id="sizeOptionsString"
            type="text"
            class="field-input"
            placeholder="e.g. REGULAR:8.40, LARGE:9.40"
          />
        </div>

        <div class="field-group">
          <label class="field-label" for="itemImgInput">
            Image URL
          </label>
          <input
            id="itemImgInput"
            type="text"
            class="field-input"
            placeholder="https://example.com/image.jpg"
            required
          />
        </div>
        <div class="field-group">
          <label class="field-label" for="itemDescInput">Short description (optional)</label>
          <input
            id="itemDescInput"
            type="text"
            class="field-input"
            placeholder="e.g. Crispy chicken burger"
          />
        </div>
        <div class="field-group">
          <label class="field-label" for="itemSectionInput">Section Name (e.g., FISH, CHICKEN)</label>
          <input
            id="itemSectionInput"
            type="text"
            class="field-input"
            placeholder="e.g. FISH"
          />
        </div>
        <button type="submit" class="btn btn-primary btn-xs" style="margin-top:4px;">
          Add item
        </button>
      </form>

      <div class="admin-section-title">
        <span>All items</span>
      </div>
      <div id="itemsList" class="items-list"></div>
    </div>
  </aside>

  <input type="file" id="changeImageInput" accept="image/*" style="display:none;" />

  <div id="cartDrawer" class="cart-drawer"></div>


  <script>
    const ADMIN_PIN = "2004";
    const STORAGE_KEY_ITEMS = "restaurant_menu_items_final";
    const STORAGE_KEY_SALES = "restaurant_today_sales";
    const STORAGE_KEY_CART = "restaurant_cart_items_v1";
    const STORAGE_KEY_DELIVERY = "restaurant_delivery_settings";

    // NEW: Data extracted from the menu board image (1000159803.jpg)
    const defaultItems = [
      // FISH
      { id: 1, name: "COD", options: [{ id: "1-R", name: "REGULAR", price: 8.40 }, { id: "1-L", name: "LARGE", price: 9.40 }], img: "https://via.placeholder.com/400x300?text=COD", section: "FISH" },
      { id: 2, name: "HADDOCK", options: [{ id: "2-R", name: "REGULAR", price: 8.40 }, { id: "2-L", name: "LARGE", price: 9.40 }], img: "https://via.placeholder.com/400x300?text=HADDOCK", section: "FISH" },
      { id: 3, name: "ROCK (HUSS)", options: [{ id: "3-R", name: "REGULAR", price: 8.40 }, { id: "3-L", name: "LARGE", price: 9.40 }], img: "https://via.placeholder.com/400x300?text=ROCK+HUSS", section: "FISH" },
      { id: 4, name: "PLAICE", options: [{ id: "4-R", name: "REGULAR", price: 8.60 }, { id: "4-L", name: "LARGE", price: 9.60 }], img: "https://via.placeholder.com/400x300?text=PLAICE", section: "FISH" },
      { id: 5, name: "COD BITES (7 Pcs)", price: 8.60, img: "https://via.placeholder.com/400x300?text=COD+BITES", section: "FISH" },
      { id: 6, name: "SCAMPI (12 Pcs)", price: 7.50, img: "https://via.placeholder.com/400x300?text=SCAMPI", section: "FISH" },
      { id: 7, name: "WHITEBAIT", price: 6.90, img: "https://via.placeholder.com/400x300?text=WHITEBAIT", section: "FISH" },
      { id: 8, name: "CALAMARI", price: 7.90, img: "https://via.placeholder.com/400x300?text=CALAMARI", section: "FISH" },
      // CHIPS
      { id: 9, name: "REG. CHIPS", price: 2.90, img: "https://via.placeholder.com/400x300?text=REG+CHIPS", section: "CHIPS" },
      { id: 10, name: "LARGE CHIPS", price: 3.90, img: "https://via.placeholder.com/400x300?text=LARGE+CHIPS", section: "CHIPS" },
      { id: 11, name: "CHIPS & CHEESE", price: 4.60, img: "https://via.placeholder.com/400x300?text=CHIPS+%26+CHEESE", section: "CHIPS" },
      // SAUSAGES
      { id: 12, name: "JUMBO SAUSAGE", price: 2.60, img: "https://via.placeholder.com/400x300?text=JUMBO+SAUSAGE", section: "SAUSAGES" },
      { id: 13, name: "JUMBO BATTERED SAUSAGE", price: 2.80, img: "https://via.placeholder.com/400x300?text=JUMBO+BATTERED", section: "SAUSAGES" },
      { id: 14, name: "SAVELOY", price: 2.60, img: "https://via.placeholder.com/400x300?text=SAVELOY", section: "SAUSAGES" },
      { id: 15, name: "VEGETABLE SAUSAGE", price: 1.90, img: "https://via.placeholder.com/400x300?text=VEG+SAUSAGE", section: "SAUSAGES" },
      // PUKKA PIES
      { id: 16, name: "STEAK & KIDNEY", price: 3.70, img: "https://via.placeholder.com/400x300?text=STEAK+%26+KIDNEY", section: "PUKKA PIES" },
      { id: 17, name: "BEEF & ONION", price: 3.70, img: "https://via.placeholder.com/400x300?text=BEEF+%26+ONION", section: "PUKKA PIES" },
      { id: 18, name: "CHICKEN & MUSHROOM", price: 3.70, img: "https://via.placeholder.com/400x300?text=CHICKEN+%26+MUSHROOM", section: "PUKKA PIES" },
      { id: 19, name: "CHEESE & ONION", price: 3.70, img: "https://via.placeholder.com/400x300?text=CHEESE+%26+ONION", section: "PUKKA PIES" },
      // BURGERS
      { id: 20, name: "1/4 POUNDER", price: 5.10, img: "https://via.placeholder.com/400x300?text=1%2F4+POUNDER", section: "BURGERS" },
      { id: 21, name: "1/2 POUNDER", price: 7.10, img: "https://via.placeholder.com/400x300?text=1%2F2+POUNDER", section: "BURGERS" },
      { id: 22, name: "CHICKEN BURGER", price: 4.20, img: "https://via.placeholder.com/400x300?text=CHICKEN+BURGER", section: "BURGERS" },
      { id: 23, name: "CHICKEN FILLET BURGER", price: 4.60, img: "https://via.placeholder.com/400x300?text=CHICKEN+FILLET", section: "BURGERS" },
      { id: 24, name: "VEGGIE BURGER", price: 4.00, img: "https://via.placeholder.com/400x300?text=VEGGIE+BURGER", section: "BURGERS" },
      { id: 25, name: "BATTERED BURGER", price: 3.30, img: "https://via.placeholder.com/400x300?text=BATTERED+BURGER", section: "BURGERS" },
      { id: 26, name: "EXTRA CHEESE", price: 0.30, img: "https://via.placeholder.com/400x300?text=EXTRA+CHEESE", section: "BURGERS" },
      // CHICKEN
      { id: 27, name: "QUARTER CHICKEN", price: 4.90, img: "https://via.placeholder.com/400x300?text=QUARTER+CHICKEN", section: "CHICKEN" },
      { id: 28, name: "HALF CHICKEN", price: 7.30, img: "https://via.placeholder.com/400x300?text=HALF+CHICKEN", section: "CHICKEN" },
      { id: 29, name: "CHICKEN NUGGETS", options: [{ id: "29-5", name: "5 Pcs", price: 4.70 }, { id: "29-10", name: "10 Pcs", price: 7.70 }], img: "https://via.placeholder.com/400x300?text=CHICKEN+NUGGETS", section: "CHICKEN" },
      { id: 30, name: "CHICKEN STRIPS (6 Pcs)", price: 4.60, img: "https://via.placeholder.com/400x300?text=CHICKEN+STRIPS", section: "CHICKEN" },
      // EXTRAS
      { id: 31, name: "MOZARELLA STICKS (6 Pcs)", price: 4.60, img: "https://via.placeholder.com/400x300?text=MOZARELLA+STICKS", section: "EXTRAS" },
      { id: 32, name: "BREADED GARLIC MUSHROOM", price: 4.30, img: "https://via.placeholder.com/400x300?text=GARLIC+MUSHROOM", section: "EXTRAS" },
      { id: 33, name: "ONION RINGS (10 Pcs)", price: 3.00, img: "https://via.placeholder.com/400x300?text=ONION+RINGS", section: "EXTRAS" },
      { id: 34, name: "COD ROE", price: 3.20, img: "https://via.placeholder.com/400x300?text=COD+ROE", section: "EXTRAS" },
      { id: 35, name: "FISH CAKE", price: 3.10, img: "https://via.placeholder.com/400x300?text=FISH+CAKE", section: "EXTRAS" },
      { id: 36, name: "CURRY SAUCE", price: 1.90, img: "https://via.placeholder.com/400x300?text=CURRY+SAUCE", section: "EXTRAS" },
      { id: 37, name: "MUSHY PEAS", price: 1.90, img: "https://via.placeholder.com/400x300?text=MUSHY+PEAS", section: "EXTRAS" },
      { id: 38, name: "BOTTLE OF KETCHUP", price: 2.40, img: "https://via.placeholder.com/400x300?text=BOTTLE+OF+KETCHUP", section: "EXTRAS" },
      { id: 39, name: "BOTTLE OF VINEGAR", price: 2.30, img: "https://via.placeholder.com/400x300?text=BOTTLE+OF+VINEGAR", section: "EXTRAS" },
      { id: 40, name: "PICKLED GHERKIN", price: 0.90, img: "https://via.placeholder.com/400x300?text=PICKLED+GHERKIN", section: "EXTRAS" },
      { id: 41, name: "PICKLED ONION", price: 0.90, img: "https://via.placeholder.com/400x300?text=PICKLED+ONION", section: "EXTRAS" },
      { id: 42, name: "PICKLED EGG", price: 0.90, img: "https://via.placeholder.com/400x300?text=PICKLED+EGG", section: "EXTRAS" },
      // MEAL DEALS / DRINKS
      { id: 43, name: "NUGGETS (4 Pcs) & CHIPS & DRINK", price: 4.90, img: "https://via.placeholder.com/400x300?text=KIDS+NUGGETS", section: "MEAL DEALS" },
      { id: 44, name: "COD BITES (3 Pcs) & CHIPS & DRINK", price: 4.90, img: "https://via.placeholder.com/400x300?text=KIDS+COD+BITES", section: "MEAL DEALS" },
      { id: 45, name: "SCAMPI (4 Pcs) & CHIPS & DRINK", price: 4.90, img: "https://via.placeholder.com/400x300?text=KIDS+SCAMPI", section: "MEAL DEALS" },
      { id: 46, name: "SAUSAGE & CHIPS AND DRINK", price: 4.90, img: "https://via.placeholder.com/400x300?text=KIDS+SAUSAGE", section: "MEAL DEALS" },
      { id: 47, name: "SAUSAGE IN BATTER & CHIPS AND DRINK", price: 4.90, img: "https://via.placeholder.com/400x300?text=KIDS+BATTERED+SAUSAGE", section: "MEAL DEALS" },
      { id: 48, name: "OAP COD & CHIPS", price: 7.10, img: "https://via.placeholder.com/400x300?text=OAP+COD", section: "MEAL DEALS" },
      { id: 49, name: "CAN OF DRINK", price: 1.40, img: "https://via.placeholder.com/400x300?text=DRINK", section: "DRINKS" },
      { id: 50, name: "WATER", price: 1.00, img: "https://via.placeholder.com/400x300?text=WATER", section: "DRINKS" },
      { id: 51, name: "KIDS DRINK", price: 1.00, img: "https://via.placeholder.com/400x300?text=KIDS+DRINK", section: "DRINKS" },
    ];

    function loadItems() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY_ITEMS);
        if (!raw) return [...defaultItems];
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed) || !parsed.length) return [...defaultItems];
        return parsed;
      } catch {
        return [...defaultItems];
      }
    }

    function saveItems() {
      try {
        localStorage.setItem(STORAGE_KEY_ITEMS, JSON.stringify(items));
      } catch {}
    }

    function loadTodaySales() {
      const raw = localStorage.getItem(STORAGE_KEY_SALES);
      const val = parseFloat(raw);
      if (isNaN(val)) return 0;
      return val;
    }

    function saveTodaySales(val) {
      localStorage.setItem(STORAGE_KEY_SALES, String(val));
    }

    function loadCart() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY_CART);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return [];
        return parsed;
      } catch {
        return [];
      }
    }

    function saveCart() {
      try {
        localStorage.setItem(STORAGE_KEY_CART, JSON.stringify(cartItems));
      } catch {}
    }

    function loadDeliverySettings() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY_DELIVERY);
        if (!raw) return { enabled: false, charge: 3 };
        const parsed = JSON.parse(raw);
        return {
          enabled: !!parsed.enabled,
          charge: isNaN(parseFloat(parsed.charge)) ? 3 : parseFloat(parsed.charge)
        };
      } catch {
        return { enabled: false, charge: 3 };
      }
    }

    function saveDeliverySettings() {
      localStorage.setItem(
        STORAGE_KEY_DELIVERY,
        JSON.stringify(deliverySettings)
      );
    }

    let items = loadItems();
    let filteredItems = [...items];
    let adminOpen = false;
    let currentImageChangeItemId = null;
    let currentModalItemId = null;
    let selectedOption = null;

    let cartItems = loadCart();
    let deliverySettings = loadDeliverySettings();
    let orderMode = "collection";

    const menuContent = document.getElementById("menuContent");
    const noResultsEl = document.getElementById("noResults");
    const itemModalBackdrop = document.getElementById("itemModalBackdrop");
    const modalImg = document.getElementById("modalImg");
    const modalName = document.getElementById("modalName");
    const modalPrice = document.getElementById("modalPrice");
    const modalDesc = document.getElementById("modalDesc");
    const modalCloseBtn = document.getElementById("modalCloseBtn");
    const modalAddBtn = document.getElementById("modalAddBtn");
    const modalCollectionBtn = document.getElementById("modalCollectionBtn");
    const modalDeliveryBtn = document.getElementById("modalDeliveryBtn");
    const optionsGroup = document.getElementById("optionsGroup");
    const searchInput = document.getElementById("searchInput");
    const searchMessage = document.getElementById("searchMessage");
    const adminPanel = document.getElementById("adminPanel");
    const adminCloseBtn = document.getElementById("adminCloseBtn");
    const itemsList = document.getElementById("itemsList");
    const todaySalesInput = document.getElementById("todaySalesInput");
    const todaySalesBadge = document.getElementById("todaySalesBadge");
    const saveSalesBtn = document.getElementById("saveSalesBtn");
    const todayBreakdown = document.getElementById("todayBreakdown");
    const addItemForm = document.getElementById("addItemForm");
    const itemNameInput = document.getElementById("itemNameInput");
    const itemPriceInput = document.getElementById("itemPriceInput");
    const itemImgInput = document.getElementById("itemImgInput");
    const itemDescInput = document.getElementById("itemDescInput");
    const sizeOptionsString = document.getElementById("sizeOptionsString");
    const itemSectionInput = document.getElementById("itemSectionInput");

    const changeImageInput = document.getElementById("changeImageInput");
    const mainContent = document.getElementById("mainContent");
    const yearEl = document.getElementById("year");
    const deliveryStatusBadge = document.getElementById("deliveryStatusBadge");
    const deliveryEnabledInput = document.getElementById("deliveryEnabledInput");
    const deliveryChargeInput = document.getElementById("deliveryChargeInput");
    const saveDeliveryBtn = document.getElementById("saveDeliveryBtn");

    const cartButton = document.getElementById("cartButton");
    const cartBubbleCount = document.getElementById("cartBubbleCount");
    const cartBubbleText = document.getElementById("cartBubbleText");


    yearEl.textContent = new Date().getFullYear();

    if (mainContent) {
      mainContent.addEventListener("scroll", () => {
        const titleGroup = document.querySelector(".brand-title-group");
        if (!titleGroup) return;
        if (mainContent.scrollTop > 5) {
          titleGroup.classList.add("scrolling");
        } else {
          titleGroup.classList.remove("scrolling");
        }
      });
    }

    function formatPrice(p) {
      const num = Number(p);
      if (isNaN(num)) return "£0.00";
      return "£" + num.toFixed(2);
    }

    function getDisplayPrice(item) {
      if (item.options && item.options.length) {
        const minPrice = item.options.reduce(
          (min, option) => Math.min(min, option.price),
          Infinity
        );
        return "From " + formatPrice(minPrice);
      }
      return formatPrice(item.price);
    }

    function getItem(id) {
      return items.find((it) => String(it.id) === String(id));
    }

    /* ========= MENU RENDER (SECTIONED) ========= */
    function renderMenu(list) {
      if (!menuContent) return;
      menuContent.innerHTML = "";

      if (!list.length) {
        noResultsEl.style.display = "block";
        return;
      }
      noResultsEl.style.display = "none";

      const sections = list.reduce((acc, item) => {
        const section = item.section || "MISCELLANEOUS";
        if (!acc[section]) acc[section] = [];
        acc[section].push(item);
        return acc;
      }, {});

      for (const sectionName in sections) {
        const sectionTitle = document.createElement("h2");
        sectionTitle.className = "section-title";
        sectionTitle.textContent = sectionName.toUpperCase();
        menuContent.appendChild(sectionTitle);

        const grid = document.createElement("div");
        grid.className = "menu-grid";

        sections[sectionName].forEach((item) => {
          const card = document.createElement("div");
          card.className = "card";
          card.dataset.id = item.id;

          card.innerHTML = `
            <div class="card-img-wrapper">
              <img src="${item.img}" alt="${item.name}" class="card-img"
                  onerror="this.src='https://via.placeholder.com/400x300?text=No+Image';" />
            </div>
            <div class="card-body">
              <div class="card-name">${item.name}</div>
              <div class="card-price" data-price-id="${item.id}">${getDisplayPrice(item)}</div>
              ${item.desc ? `<div class="card-desc">${item.desc}</div>` : ""}
              <button class="add-to-cart-btn" data-id="${item.id}" title="Quick add">+</button>
            </div>
          `;

          card.addEventListener("click", (e) => {
            if (!e.target.classList.contains("add-to-cart-btn")) {
              openItemModal(item.id);
            }
          });

          const addBtn = card.querySelector(".add-to-cart-btn");
          addBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            quickAddToCart(item.id, addBtn);
          });

          grid.appendChild(card);
        });
        menuContent.appendChild(grid);
      }
    }

    /* ========= CART LOGIC ========= */
    function getCartKey(itemId, optionId) {
      return optionId ? `${itemId}:${optionId}` : `single:${itemId}`;
    }

    function addToCart(item, option, quantity = 1, sourceEl = null) {
      if (!item) return;
      const key = getCartKey(item.id, option && option.id);
      const name =
        option && option.name
          ? `${item.name} (${option.name})`
          : item.name;
      const price =
        option && typeof option.price === "number"
          ? option.price
          : item.price;

      if (typeof price !== "number" || isNaN(price)) return;

      const existing = cartItems.find((c) => c.key === key);
      if (existing) {
        existing.qty += quantity;
      } else {
        cartItems.push({
          key,
          itemId: item.id,
          optionId: option && option.id ? option.id : null,
          name,
          price,
          qty: quantity
        });
      }
      saveCart();
      animateToCart(sourceEl || cartButton);
      renderCartSummary(true);
    }

    function quickAddToCart(itemId, triggerEl) {
      const item = getItem(itemId);
      if (!item) return;

      if (item.options && item.options.length) {
        const defaultOption = item.options[0];
        addToCart(item, defaultOption, 1, triggerEl);
      } else {
        addToCart(item, null, 1, triggerEl);
      }
    }

    function renderCartSummary(bump = false) {
      const itemCount = cartItems.reduce((sum, c) => sum + c.qty, 0);
      const subtotal = cartItems.reduce(
        (sum, c) => sum + c.qty * c.price,
        0
      );

      cartBubbleCount.textContent = itemCount;
      cartBubbleText.textContent = formatPrice(subtotal);

      if (bump) {
        cartButton.classList.remove("cart-bump");
        void cartButton.offsetWidth;
        cartButton.classList.add("cart-bump");
      }
    }

    /* ========= CART CHECKOUT VIA ALERT (SIMULATION) ========= */
    function checkoutCart() {
      if (!cartItems.length) {
        alert("Your cart is empty. Add at least one item first.");
        return;
      }

      const lines = cartItems
        .map(c => `${c.qty} × ${c.name} = ${formatPrice(c.qty * c.price)}`)
        .join("\n");

      let mode = "collection";
      if (deliverySettings.enabled) {
        const inp = prompt('Type "c" for collection or "d" for delivery:', "c");
        if (inp === null) return;
        mode = (inp.toLowerCase() === "d") ? "delivery" : "collection";
      }

      const subtotal = cartItems.reduce((sum, c) => sum + c.qty * c.price, 0);
      const deliveryCharge =
        mode === "delivery" && deliverySettings.enabled
          ? (deliverySettings.charge || 0)
          : 0;
      const total = subtotal + deliveryCharge;

      const name = prompt("Your name:");
      if (!name) {
        alert("Order cancelled (no name).");
        return;
      }

      let extra = "";
      if (mode === "delivery") {
        const phone = prompt("Phone number:");
        const address = prompt("Delivery address:");
        extra = `\nPhone: ${phone || "-"}\nAddress: ${address || "-"}`;
      }

      const note = prompt("Any note for this order? (optional)");
      const notePart = note ? `\nNote: ${note}` : "";

      alert(
        `ORDER CONFIRMED (${mode.toUpperCase()}) — Simulation Only\n\n` +
        lines +
        `\n\nSubtotal: ${formatPrice(subtotal)}` +
        (mode === "delivery" ? `\nDelivery: ${formatPrice(deliveryCharge)}` : "") +
        `\nTotal: ${formatPrice(total)}\nName: ${name}${extra}${notePart}\n\n` +
        "This is only a demo. In real life this would be sent to your system/kitchen."
      );

      cartItems = [];
      saveCart();
      renderCartSummary();
    }

    /* ========= FLY TO CART (SLOWER) ========= */
    function animateToCart(sourceElement) {
      if (!sourceElement || !cartButton) return;
      const sourceRect = sourceElement.getBoundingClientRect();
      const cartRect = cartButton.getBoundingClientRect();

      const startX = sourceRect.left + sourceRect.width / 2;
      const startY = sourceRect.top + sourceRect.height / 2;
      const endX = cartRect.left + cartRect.width / 2;
      const endY = cartRect.top + cartRect.height / 2;

      const dot = document.createElement("div");
      dot.className = "fly-dot";
      dot.style.left = startX + "px";
      dot.style.top = startY + "px";
      document.body.appendChild(dot);

      const dx = endX - startX;
      const dy = endY - startY;

      requestAnimationFrame(() => {
        dot.style.transform = `translate(${dx}px, ${dy}px) scale(0.3)`;
        dot.style.opacity = "0";
      });

      dot.addEventListener("transitionend", () => {
        dot.remove();
      });
    }

    /* ========= MODAL / ADMIN LOGIC (REST OF THE CODE) ========= */

    function renderHeaderDeliveryStatus() {
      if (deliverySettings.enabled) {
        deliveryStatusBadge.textContent =
          "Delivery & collection available today";
        deliveryStatusBadge.classList.remove("off");
      } else {
        deliveryStatusBadge.textContent = "Collection only today";
        deliveryStatusBadge.classList.add("off");
      }
    }
    
    function directOrder(mode) {
      const item = getItem(currentModalItemId);
      if (!item) return;

      if (item.options && item.options.length && !selectedOption) {
        alert("Please select an option first.");
        return;
      }

      const opt = selectedOption || null;
      const price = opt ? opt.price : item.price;
      const name = opt ? `${item.name} (${opt.name})` : item.name;

      let customerName = prompt("Your name:");
      if (!customerName) {
        alert("Order cancelled (no name).");
        return;
      }

      let extra = "";
      if (mode === "delivery") {
        if (!deliverySettings.enabled) {
          alert("Delivery is currently disabled.");
          return;
        }
        const phone = prompt("Phone number:");
        const address = prompt("Delivery address:");
        extra = `\nPhone: ${phone || "-"}\nAddress: ${address || "-"}`;
      }

      const note = prompt("Any note for this order? (optional)");
      const notePart = note ? `\nNote: ${note}` : "";

      alert(
        `DIRECT ${mode.toUpperCase()} ORDER — Simulation Only\n\n` +
        `Item: ${name}\nPrice: ${formatPrice(price)}\nName: ${customerName}${extra}${notePart}\n\n` +
        "This is only a demo. In real system this would be sent to your kitchen / payment."
      );

      closeItemModal();
    }
    
    function openItemModal(itemId) {
      const item = getItem(itemId);
      if (!item) return;

      currentModalItemId = itemId;
      selectedOption = null;

      modalImg.src = item.img;
      modalImg.alt = item.name;
      modalName.textContent = item.name;
      modalDesc.textContent =
        item.desc || "Freshly prepared from our kitchen.";

      if (item.options && item.options.length > 0) {
        modalPrice.textContent = "Select an option";
        modalAddBtn.disabled = true;
        optionsGroup.style.display = "block";
        optionsGroup.innerHTML = "";

        item.options.forEach((option) => {
          const optionEl = document.createElement("div");
          optionEl.className = "option-radio";
          optionEl.dataset.optionId = option.id;
          optionEl.innerHTML = `
            <span class="option-name">${option.name}</span>
            <span class="option-price">${formatPrice(option.price)}</span>
          `;

          optionEl.addEventListener("click", () => {
            optionsGroup
              .querySelectorAll(".option-radio")
              .forEach((el) => el.classList.remove("selected"));
            optionEl.classList.add("selected");
            selectedOption = option;
            modalPrice.textContent = formatPrice(option.price);
            modalAddBtn.disabled = false;
          });
          optionsGroup.appendChild(optionEl);
        });
      } else {
        modalPrice.textContent = getDisplayPrice(item);
        modalAddBtn.disabled = false;
        optionsGroup.style.display = "none";
        optionsGroup.innerHTML = "";
      }

      modalCollectionBtn.style.display = "inline-flex";
      if (deliverySettings.enabled) {
        modalDeliveryBtn.style.display = "inline-flex";
      } else {
        modalDeliveryBtn.style.display = "none";
      }

      itemModalBackdrop.classList.add("show");
    }

    function closeItemModal() {
      itemModalBackdrop.classList.remove("show");
      currentModalItemId = null;
      selectedOption = null;
    }
    
    function editItemOptions(itemId) {
      const item = getItem(itemId);
      if (!item) return;

      if (!item.options || !item.options.length) {
        const confirmConvert = confirm(
          `Item "${item.name}" currently has a single price. Convert it to multiple options?`
        );
        if (!confirmConvert) return;

        const basePrice = Number(item.price) || 0;
        item.options = [
          {
            id: `${item.id}-R`,
            name: "REGULAR",
            price: basePrice
          }
        ];
        delete item.price;
      }

      let existing = item.options
        .map((opt) => `${opt.name}:${opt.price}`)
        .join(", ");

      const newOptionsRaw = prompt(
        `Edit options for ${item.name}:\n\n` +
          `Enter options separated by comma, in the format:\n` +
          `Name:Price, Name:Price\n\n` +
          `Example:\nREGULAR:7.50, LARGE:9.99\n\n` +
          `Current options:\n${existing}`
      );

      if (newOptionsRaw === null) return;

      const parts = newOptionsRaw.split(',').map(p => p.trim()).filter(p => p !== '');
      let newOptions = [];
      let error = false;

      parts.forEach((part, index) => {
        const [nameRaw, priceRaw] = part.split(':').map(s => s.trim());
        const price = parseFloat(priceRaw);
        const name = nameRaw.toUpperCase();

        if (!name || isNaN(price) || price < 0) {
          alert(`Error in part ${index + 1} ("${part}"): Invalid format or price.`);
          error = true;
          return;
        }

        newOptions.push({
          id: `${item.id}-${name.replace(/\s/g, '').substring(0, 3)}`,
          name: name,
          price: price
        });
      });

      if (error || newOptions.length === 0) {
        if (!error)
          alert(
            "No valid options found, reverting changes."
          );
        return;
      }

      item.options = newOptions;
      if (item.price) delete item.price;

      saveItems();
      filteredItems = [...items];
      renderItemsList();
      renderMenu(filteredItems);
      alert(`${item.name} options updated!`);
    }

    function editItemPrice(itemId) {
      const item = getItem(itemId);
      if (!item || (item.options && item.options.length)) {
        alert(
          "This item already has multiple options. Please edit options instead of single price."
        );
        return;
      }

      const newPriceRaw = prompt(
        `Enter new price for ${item.name} (current: ${formatPrice(
          item.price
        )}):`
      );

      if (newPriceRaw === null) return;

      const newPrice = parseFloat(newPriceRaw.trim());

      if (isNaN(newPrice) || newPrice < 0) {
        alert("Please enter a valid price (0 or greater).");
        return;
      }

      item.price = newPrice;
      saveItems();

      renderItemsList();
      renderMenu(filteredItems);
      alert(`${item.name} price updated to ${formatPrice(newPrice)}.`);
    }

    function openAdminPanel() {
      adminOpen = true;
      adminPanel.classList.add("open");
      searchInput.value = "";
      searchInput.blur();
      searchMessage.style.display = "none";
      filteredItems = [...items];
      renderMenu(filteredItems);
      renderItemsList();

      const today = loadTodaySales();
      todaySalesInput.value = today ? today.toFixed(2) : "";
      updateTodayBreakdown(today);

      deliveryEnabledInput.checked = deliverySettings.enabled;
      deliveryChargeInput.value =
        typeof deliverySettings.charge === "number"
          ? deliverySettings.charge.toFixed(2)
          : "";
          
      // Clear Add Item Form
      addItemForm.reset();
    }

    function closeAdminPanel() {
      adminOpen = false;
      adminPanel.classList.remove("open");
    }

    function renderItemsList() {
      itemsList.innerHTML = "";
      if (!items.length) {
        itemsList.innerHTML =
          '<div class="items-row"><span>No items yet.</span></div>';
        return;
      }

      const sections = items.reduce((acc, item) => {
        const section = item.section || "UNSORTED";
        if (!acc[section]) acc[section] = [];
        acc[section].push(item);
        return acc;
      }, {});
      
      let html = '';
      for (const sectionName in sections) {
        html += `<div class="item-section-divider">${sectionName}</div>`;
        sections[sectionName].forEach((item) => {
            const hasOptions = item.options && item.options.length > 0;
            const currentPriceText = hasOptions
              ? `(${item.options.length} options)`
              : formatPrice(item.price);
            
            html += `
              <div class="items-row">
                <div>
                  <span class="items-row-name">${item.name}</span>
                  <span class="items-row-price">${currentPriceText}</span>
                </div>
                <div class="items-row-actions">
                  <button class="btn btn-outline btn-xs"
                          data-edit-type="${hasOptions ? "options" : "price"}"
                          data-id="${item.id}">
                    ${hasOptions ? "Options" : "Price"}
                  </button>
                  <button class="btn btn-outline btn-xs" data-image="${item.id}">
                    Image
                  </button>
                  <button class="btn btn-outline btn-xs" data-delete="${item.id}">
                    Delete
                  </button>
                </div>
              </div>
            `;
        });
      }
      itemsList.innerHTML = html;

      itemsList.querySelectorAll("[data-edit-type]").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-id");
          const type = btn.getAttribute("data-edit-type");
          if (type === "price") {
            editItemPrice(id);
          } else if (type === "options") {
            editItemOptions(id);
          }
        });
      });

      itemsList.querySelectorAll("[data-delete]").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-delete");
          if (confirm("Are you sure you want to delete this item?")) {
            items = items.filter((it) => String(it.id) !== String(id));
            saveItems();
            filteredItems = [...items];
            renderItemsList();
            renderMenu(filteredItems);
          }
        });
      });

      itemsList.querySelectorAll("[data-image]").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-image");
          currentImageChangeItemId = id;
          changeImageInput.click();
        });
      });
    }

    function updateTodayBreakdown(amount) {
      if (!todayBreakdown) return;
      const total = Number(amount) || 0;
      const seven = total * 0.07;
      const ninetyThree = total * 0.93;
      todayBreakdown.textContent =
        `Total: ${formatPrice(total)} • 7%: ${formatPrice(seven)} • 93%: ${formatPrice(ninetyThree)}`;
    }
    
    saveSalesBtn.addEventListener("click", () => {
      const raw = todaySalesInput.value.trim();
      const num = parseFloat(raw);
      if (isNaN(num) || num < 0) {
        alert("Please enter a valid amount (0 or greater).");
        return;
      }
      saveTodaySales(num);
      updateTodaySalesBadge();
      updateTodayBreakdown(num);
      alert("Today's total saved.");
    });

    todaySalesInput.addEventListener("input", () => {
      updateTodayBreakdown(todaySalesInput.value);
    });

    saveDeliveryBtn.addEventListener("click", () => {
      const enabled = deliveryEnabledInput.checked;
      const chargeRaw = deliveryChargeInput.value.trim();
      const chargeNum = parseFloat(chargeRaw);
      if (enabled && (isNaN(chargeNum) || chargeNum < 0)) {
        alert("Please enter a valid delivery charge (e.g. 3.00).");
        return;
      }
      deliverySettings.enabled = enabled;
      if (!isNaN(chargeNum) && chargeNum >= 0) {
        deliverySettings.charge = chargeNum;
      }
      saveDeliverySettings();
      renderHeaderDeliveryStatus();
      alert("Delivery settings saved.");
    });

    addItemForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = itemNameInput.value.trim();
      const img = itemImgInput.value.trim();
      const desc = itemDescInput.value.trim();
      const singlePriceRaw = itemPriceInput.value.trim();
      const sizeOptionsRaw = sizeOptionsString.value.trim();
      const section = itemSectionInput.value.trim().toUpperCase() || "UNSORTED";

      if (!name || !img) {
        alert("Please fill in at least name and image URL.");
        return;
      }
      
      const maxId = items.reduce((max, it) => (it.id > max ? it.id : max), 0);
      const newId = maxId + 1;
      let newItem = { id: newId, name, img, desc, section };
      let hasPrice = false;

      if (sizeOptionsRaw) {
        const parts = sizeOptionsRaw.split(',').map(p => p.trim()).filter(p => p !== '');
        let options = [];
        let error = false;
        
        parts.forEach((part) => {
            const [nameRaw, priceRaw] = part.split(':').map(s => s.trim());
            const price = parseFloat(priceRaw);
            const name = nameRaw.toUpperCase();

            if (!name || isNaN(price) || price < 0) {
              error = true;
            } else {
               options.push({ id: `${newId}-${name.replace(/\s/g, '').substring(0, 3)}`, name: name, price: price });
            }
        });
        
        if (error || options.length === 0) {
             alert("Error in options format (Name:Price, Name:Price) or invalid price. Item not added.");
             return;
        }
        newItem.options = options;
        hasPrice = true;
        
      } else if (singlePriceRaw) {
        const price = parseFloat(singlePriceRaw);
        if (isNaN(price) || price < 0) {
          alert("Please enter a valid single price (0 or greater).");
          return;
        }
        newItem.price = price;
        hasPrice = true;
      }

      if (!hasPrice) {
          alert("Please enter either a Single Price or Options.");
          return;
      }

      items.push(newItem);
      saveItems();
      filteredItems = [...items];
      renderItemsList();
      renderMenu(filteredItems);

      addItemForm.reset();
      alert("New item added.");
    });

    changeImageInput.addEventListener("change", (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file || !currentImageChangeItemId) {
        changeImageInput.value = "";
        return;
      }

      const reader = new FileReader();
      reader.onload = (ev) => {
        const dataUrl = ev.target.result;
        const item = getItem(currentImageChangeItemId);
        if (item) {
          item.img = dataUrl;
          saveItems();
          filteredItems = [...items];
          renderItemsList();
          renderMenu(filteredItems);
          if (
            String(currentModalItemId) ===
            String(currentImageChangeItemId)
          ) {
            modalImg.src = dataUrl;
          }
          alert("Image updated.");
        }
        currentImageChangeItemId = null;
        changeImageInput.value = "";
      };
      reader.readAsDataURL(file);
    });

    cartButton.addEventListener("click", () => {
      checkoutCart();
    });
    
    modalCollectionBtn.addEventListener("click", () => {
        directOrder("collection");
